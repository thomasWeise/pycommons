<!doctype html><html data-content_root=../../../ lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0"name=viewport><title>pycommons.math.sample_statistics — pycommons 0.8.89 documentation</title><link href="../../../_static/pygments.css?v=b86133f3"rel=stylesheet><link href="../../../_static/bizstyle.css?v=5283bb3d"rel=stylesheet><script src="../../../_static/documentation_options.js?v=4db5eb0a"></script><script src="../../../_static/doctools.js?v=fd6eb6e6"></script><script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script><script src=../../../_static/bizstyle.js></script><link href=https://thomasweise.github.io/pycommons/_modules/pycommons/math/sample_statistics.html rel=canonical><link href=../../../genindex.html rel=index title=Index><link href=../../../search.html rel=search title=Search><meta content="width=device-width,initial-scale=1.0"name=viewport><body><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"accesskey=I href=../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../index.html>pycommons 0.8.89 documentation</a> »<li class="nav-item nav-item-1"><a accesskey=U href=../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>pycommons.math.sample_statistics</a></ul></div><div class=document><div class=documentwrapper><div class=bodywrapper><div class=body role=main><h1>Source code for pycommons.math.sample_statistics</h1><div class=highlight><pre>
<span></span><span class=sd>"""</span>
<span class=sd>A simple and immutable basic statistics record computed over a data sample.</span>

<span class=sd>Here we provide records of statistics that are computed over a fully available</span>
<span class=sd>sample of data.</span>
<span class=sd>Such records are instances of class</span>
<span class=sd>:class:`~pycommons.math.sample_statistics.SampleStatistics`.</span>
<span class=sd>They offer the</span>
<span class=sd>:attr:`~pycommons.math.stream_statistics.StreamStatistics.minimum` and</span>
<span class=sd>:attr:`~pycommons.math.stream_statistics.StreamStatistics.maximum` of the data</span>
<span class=sd>as well as the number</span>
<span class=sd>:attr:`~pycommons.math.stream_statistics.StreamStatistics.n` of observed</span>
<span class=sd>samples.</span>
<span class=sd>They also offer approximations of the arithmetic mean as attribute</span>
<span class=sd>:attr:`~pycommons.math.stream_statistics.StreamStatistics.mean_arith` and</span>
<span class=sd>the approximation of the standard deviation as attribute</span>
<span class=sd>:attr:`~pycommons.math.stream_statistics.StreamStatistics.stddev`.</span>
<span class=sd>Additionally, they provide the sample</span>
<span class=sd>:attr:`~pycommons.math.sample_statistics.SampleStatistics.median`</span>
<span class=sd>and an approximation</span>
<span class=sd>:attr:`~pycommons.math.sample_statistics.SampleStatistics.mean_geom` of the</span>
<span class=sd>geometric mean.</span>

<span class=sd>This class is an extension of class</span>
<span class=sd>:class:`~pycommons.math.stream_statistics.StreamStatistics`.</span>
<span class=sd>Stream statistics are less accurate and do not provide the median or geometric</span>
<span class=sd>mean.</span>
<span class=sd>They, however, can be applied to a stream of data and do not require that all</span>
<span class=sd>the data be available as a complete chunk at once.</span>
<span class=sd>Sample statistics require access to the full data, but also offer higher</span>
<span class=sd>accuracy.</span>

<span class=sd>There is an absolute order defined upon these records.</span>
<span class=sd>They are hashable and immutable.</span>
<span class=sd>We provide methods to store them to CSV format via the class</span>
<span class=sd>:class:`~pycommons.math.sample_statistics.CsvWriter`</span>
<span class=sd>and to load them from CSV data via the class</span>
<span class=sd>:class:`~pycommons.math.sample_statistics.CsvReader`.</span>
<span class=sd>Functions that access attributes can be obtained via</span>
<span class=sd>:meth:`~pycommons.math.stream_statistics.StreamStatistics.getter`.</span>

<span class=sd>>>> ag = SampleStatistics.aggregate()</span>
<span class=sd>>>> ag.update((1, 2, 3))</span>
<span class=sd>>>> ag.add(4)</span>
<span class=sd>>>> ag.add(5)</span>
<span class=sd>>>> r1 = ag.result()</span>
<span class=sd>>>> repr(r1)</span>
<span class=sd>'SampleStatistics(n=5, minimum=1, mean_arith=3, maximum=5, \</span>
<span class=sd>stddev=1.5811388300841898, median=3, mean_geom=2.6051710846973517)'</span>
<span class=sd>>>> str(r1)</span>
<span class=sd>'5;1;3;3;2.6051710846973517;5;1.5811388300841898'</span>

<span class=sd>>>> r2 = SampleStatistics.from_samples((1, 2, 3, 4, 5))</span>
<span class=sd>>>> r1 == r2</span>
<span class=sd>True</span>

<span class=sd>>>> ag.reset()</span>
<span class=sd>>>> try:</span>
<span class=sd>...     ag.result()</span>
<span class=sd>... except ValueError as ve:</span>
<span class=sd>...     print(ve)</span>
<span class=sd>Data source cannot be empty.</span>

<span class=sd>>>> print(ag.result_or_none())</span>
<span class=sd>None</span>
<span class=sd>"""</span>

<span class=kn>from</span><span class=w> </span><span class=nn>contextlib</span><span class=w> </span><span class=kn>import</span> <span class=n>suppress</span>
<span class=kn>from</span><span class=w> </span><span class=nn>dataclasses</span><span class=w> </span><span class=kn>import</span> <span class=n>dataclass</span>
<span class=kn>from</span><span class=w> </span><span class=nn>fractions</span><span class=w> </span><span class=kn>import</span> <span class=n>Fraction</span>
<span class=kn>from</span><span class=w> </span><span class=nn>math</span><span class=w> </span><span class=kn>import</span> <span class=n>ceil</span><span class=p>,</span> <span class=n>inf</span><span class=p>,</span> <span class=n>isfinite</span><span class=p>,</span> <span class=n>nan</span><span class=p>,</span> <span class=n>nextafter</span>
<span class=kn>from</span><span class=w> </span><span class=nn>statistics</span><span class=w> </span><span class=kn>import</span> <span class=n>geometric_mean</span> <span class=k>as</span> <span class=n>stat_geomean</span>
<span class=kn>from</span><span class=w> </span><span class=nn>statistics</span><span class=w> </span><span class=kn>import</span> <span class=n>mean</span> <span class=k>as</span> <span class=n>stat_mean</span>
<span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Final</span><span class=p>,</span> <span class=n>Iterable</span><span class=p>,</span> <span class=n>Union</span>

<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.io.csv</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>CSV_SEPARATOR</span><span class=p>,</span>
    <span class=n>csv_column</span><span class=p>,</span>
    <span class=n>csv_column_or_none</span><span class=p>,</span>
    <span class=n>csv_val_or_none</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.io.csv</span><span class=w> </span><span class=kn>import</span> <span class=n>CsvReader</span> <span class=k>as</span> <span class=n>CsvReaderBase</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.math.int_math</span><span class=w> </span><span class=kn>import</span> <span class=n>__DBL_INT_LIMIT_P_I</span> <span class=k>as</span> <span class=n>_DBL_INT_LIMIT_P_I</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.math.int_math</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>ceil_div</span><span class=p>,</span>
    <span class=n>float_to_frac</span><span class=p>,</span>
    <span class=n>try_int</span><span class=p>,</span>
    <span class=n>try_int_div</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.math.stream_statistics</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>KEY_MAXIMUM</span><span class=p>,</span>
    <span class=n>KEY_MEAN_ARITH</span><span class=p>,</span>
    <span class=n>KEY_MEAN_GEOM</span><span class=p>,</span>
    <span class=n>KEY_MEDIAN</span><span class=p>,</span>
    <span class=n>KEY_MINIMUM</span><span class=p>,</span>
    <span class=n>KEY_N</span><span class=p>,</span>
    <span class=n>KEY_STDDEV</span><span class=p>,</span>
    <span class=n>StreamStatistics</span><span class=p>,</span>
    <span class=n>StreamStatisticsAggregate</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.math.stream_statistics</span><span class=w> </span><span class=kn>import</span> <span class=n>CsvWriter</span> <span class=k>as</span> <span class=n>CsvWriterBase</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.strings.string_conv</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>str_to_num</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.types</span><span class=w> </span><span class=kn>import</span> <span class=n>check_int_range</span><span class=p>,</span> <span class=n>type_error</span>


<span class=k>def</span><span class=w> </span><span class=nf>_mean_of_two</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Compute the mean of two numbers.</span>

<span class=sd>    :param a: the first number</span>
<span class=sd>    :param b: the second number</span>
<span class=sd>    :returns: the mean</span>

<span class=sd>    >>> _mean_of_two(1, 1)</span>
<span class=sd>    1</span>
<span class=sd>    >>> _mean_of_two(1.0, 1.0)</span>
<span class=sd>    1</span>
<span class=sd>    >>> _mean_of_two(1, 2)</span>
<span class=sd>    1.5</span>
<span class=sd>    >>> _mean_of_two(1, 3)</span>
<span class=sd>    2</span>
<span class=sd>    >>> _mean_of_two(1.5, 1.7)</span>
<span class=sd>    1.6</span>

<span class=sd>    >>> _mean_of_two(-1, -1)</span>
<span class=sd>    -1</span>
<span class=sd>    >>> _mean_of_two(-1.0, -1.0)</span>
<span class=sd>    -1</span>
<span class=sd>    >>> _mean_of_two(-1, -2)</span>
<span class=sd>    -1.5</span>
<span class=sd>    >>> _mean_of_two(-1, -3)</span>
<span class=sd>    -2</span>
<span class=sd>    >>> _mean_of_two(-1.5, -1.7)</span>
<span class=sd>    -1.6</span>

<span class=sd>    >>> _mean_of_two(1, -1)</span>
<span class=sd>    0</span>
<span class=sd>    >>> _mean_of_two(-1.0, 1.0)</span>
<span class=sd>    0</span>
<span class=sd>    >>> _mean_of_two(1, -2)</span>
<span class=sd>    -0.5</span>
<span class=sd>    >>> _mean_of_two(1, -3)</span>
<span class=sd>    -1</span>
<span class=sd>    >>> _mean_of_two(1.5, -1.7)</span>
<span class=sd>    -0.09999999999999998</span>
<span class=sd>    >>> _mean_of_two(-1.5, 1.7)</span>
<span class=sd>    0.09999999999999998</span>

<span class=sd>    >>> _mean_of_two(1.7976931348623157e+308, 1.7976931348623157e+308)</span>
<span class=sd>    1.7976931348623157e+308</span>
<span class=sd>    >>> _mean_of_two(1.7976931348623155e+308, 1.7976931348623157e+308)</span>
<span class=sd>    1.7976931348623155e+308</span>
<span class=sd>    """</span>
    <span class=n>a</span> <span class=o>=</span> <span class=n>try_int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
    <span class=n>b</span> <span class=o>=</span> <span class=n>try_int</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>a</span> <span class=o>==</span> <span class=n>b</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>a</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>try_int_div</span><span class=p>(</span><span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>

    <span class=n>res</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span>
    <span class=k>return</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>*</span> <span class=n>res</span><span class=p>)</span> <span class=k>if</span> <span class=n>isfinite</span><span class=p>(</span><span class=n>res</span><span class=p>)</span> <span class=k>else</span> <span class=p>((</span><span class=mf>0.5</span> <span class=o>*</span> <span class=n>a</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>*</span> <span class=n>b</span><span class=p>))</span>


<span class=k>def</span><span class=w> </span><span class=nf>_almost_le</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-></span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Check if `a <= b` holds approximately.</span>

<span class=sd>    `a <= b` holds if, well, `a` is less than or equal to `b`. It holds almost</span>
<span class=sd>    if `a` is just a tiny bit larger than `b`.</span>

<span class=sd>    :param a: the first value</span>
<span class=sd>    :param b: the second value</span>
<span class=sd>    :returns: `True` if we can say: `a` is approximately less or equal than `b`</span>
<span class=sd>        and any deviation from this probably results from numerical issues.</span>

<span class=sd>    >>> _almost_le(1, 0)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(0, 0)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(1.1, 1.09)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(1.1, 1.099999)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(1.1, 1.09999999)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(1.1, 1.0999999999)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(1.1, 1.099999999999)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(1.099999999999, 1.1)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(1.1, 1.0999999999999)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(1.0999999999999, 1.1)</span>
<span class=sd>    True</span>

<span class=sd>    >>> _almost_le(0, -1)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(-1.09, -1.1)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(-1.099999, -1.1)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(-1.09999999, -1.1)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(-1.0999999999, -1.1)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(-1.099999999999, -1.1)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(-1.1, -1.099999999999)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(-1.0999999999999, -1.1)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(-1.1, -1.0999999999999)</span>
<span class=sd>    True</span>

<span class=sd>    >>> _almost_le(23384026197294446691258957323460528314494920687616,</span>
<span class=sd>    ...             2.3384026197294286e+49)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(nextafter(5, inf), nextafter(5, -inf))</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(nextafter(nextafter(5, inf), inf),</span>
<span class=sd>    ...             nextafter(nextafter(5, -inf), -inf))</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(nextafter(nextafter(nextafter(5, inf), inf), inf),</span>
<span class=sd>    ...             nextafter(nextafter(nextafter(5, -inf), -inf), -inf))</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(nextafter(nextafter(nextafter(nextafter(5, inf), inf),</span>
<span class=sd>    ...             inf), inf), nextafter(nextafter(nextafter(5, -inf),</span>
<span class=sd>    ...             -inf), -inf))</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(5.114672824837722e+148, 5.1146728248374894e+148)</span>
<span class=sd>    True</span>

<span class=sd>    >>> _almost_le(-1.7976931348623157e+308,</span>
<span class=sd>    ...             -int(1.7976931348623157e+308) * 10)</span>
<span class=sd>    False</span>
<span class=sd>    >>> _almost_le(-int(1.7976931348623157e+308) * 10,</span>
<span class=sd>    ...             -1.7976931348623157e+308)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(1e-302, 0)</span>
<span class=sd>    True</span>
<span class=sd>    >>> _almost_le(1e-200, 0)</span>
<span class=sd>    False</span>
<span class=sd>    """</span>
    <span class=k>if</span> <span class=n>a</span> <span class=o><=</span> <span class=n>b</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>True</span>

    <span class=k>if</span> <span class=n>a</span> <span class=o><</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=o>-</span><span class=n>b</span><span class=p>,</span> <span class=o>-</span><span class=n>a</span>  <span class=c1># maybe: a = -19, b = -20 -> maybe: a = 20, b = 19</span>
    <span class=k>elif</span> <span class=n>b</span> <span class=o><=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>b</span> <span class=o>>=</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>a</span> <span class=o><=</span> <span class=mf>1e-300</span><span class=p>)</span>

    <span class=k>with</span> <span class=n>suppress</span><span class=p>(</span><span class=ne>OverflowError</span><span class=p>):</span>
        <span class=n>use_a</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>a</span>
        <span class=n>use_b</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>b</span>
        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
            <span class=n>use_a</span> <span class=o>=</span> <span class=n>nextafter</span><span class=p>(</span><span class=n>use_a</span><span class=p>,</span> <span class=o>-</span><span class=n>inf</span><span class=p>)</span>
            <span class=n>use_b</span> <span class=o>=</span> <span class=n>nextafter</span><span class=p>(</span><span class=n>use_b</span><span class=p>,</span> <span class=n>inf</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>use_a</span> <span class=o><=</span> <span class=n>use_b</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>True</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>b</span> <span class=o>/</span> <span class=n>a</span><span class=p>)</span> <span class=o>></span> <span class=mf>0.9999999999999</span>
    <span class=k>except</span> <span class=ne>OverflowError</span><span class=p>:</span>
        <span class=n>a_int</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
        <span class=n>b_int</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
        <span class=k>return</span> <span class=p>(</span><span class=mi>9999999999999</span> <span class=o>*</span> <span class=n>a_int</span><span class=p>)</span> <span class=o><=</span> <span class=p>(</span><span class=n>b_int</span> <span class=o>*</span> <span class=mi>10000000000000</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>_to_frac</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-></span> <span class=n>Fraction</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Convert a number to a fraction.</span>

<span class=sd>    :param a: the number</span>
<span class=sd>    :returns: the fraction</span>

<span class=sd>    >>> _to_frac(23)</span>
<span class=sd>    Fraction(23, 1)</span>
<span class=sd>    >>> _to_frac(2.34)</span>
<span class=sd>    Fraction(117, 50)</span>
<span class=sd>    """</span>
    <span class=k>return</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=k>else</span> <span class=n>Fraction</span><span class=p>(</span><span class=o>*</span><span class=n>float_to_frac</span><span class=p>(</span><span class=n>a</span><span class=p>))</span>


<span class=k>def</span><span class=w> </span><span class=nf>_from_frac</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=n>Fraction</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Convert a fraction to either an integer or a float.</span>

<span class=sd>    :param a: the fraction</span>
<span class=sd>    :returns: the integer or float value</span>

<span class=sd>    >>> _from_frac(1.6)</span>
<span class=sd>    1.6</span>
<span class=sd>    >>> _from_frac(123)</span>
<span class=sd>    123</span>
<span class=sd>    >>> _from_frac(Fraction(7, 8))</span>
<span class=sd>    0.875</span>
<span class=sd>    >>> _from_frac(Fraction(1237, 1))</span>
<span class=sd>    1237</span>
<span class=sd>    """</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>a</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=nb>float</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>try_int</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
    <span class=n>num</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=o>.</span><span class=n>numerator</span>
    <span class=n>denom</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=o>.</span><span class=n>denominator</span>
    <span class=k>if</span> <span class=n>denom</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>num</span>
    <span class=k>return</span> <span class=n>try_int_div</span><span class=p>(</span><span class=n>num</span><span class=p>,</span> <span class=n>denom</span><span class=p>)</span>


<span class=c1>#: the 0 fraction</span>
<span class=n>_FRAC_0</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=n>Fraction</span><span class=p>]</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=c1>#: the 1 fraction</span>
<span class=n>_FRAC_1</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=n>Fraction</span><span class=p>]</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>_int_root_bound_lower</span><span class=p>(</span><span class=n>base</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>root</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Compute a lower bound for a root.</span>

<span class=sd>    We use that `log(a ** b) = log(a) * b`.</span>
<span class=sd>    In binary, this means that: `a ** b == 2 ** (log2(a) * b)`, or, for roots</span>
<span class=sd>    `a ** (1/b) == 2 ** (log2(a) / b`.</span>
<span class=sd>    In bits, `2 ** x == 1 << x` and `floor(log2(x)) == x.bit_length() - 1`.</span>
<span class=sd>    Therefore, we know that `a ** (1/b) >= 1 << ((a.bit_length() // b) - 1)`.</span>
<span class=sd>    Similarly, we can have an upper bound by rounding up at each step</span>
<span class=sd>    `a ** (1/b) <= 1 << (1 + ((b.bit_length() + 1) // root)</span>

<span class=sd>    :param base: the base number</span>
<span class=sd>    :param root: the root</span>
<span class=sd>    :returns: the lower bound</span>

<span class=sd>    >>> _int_root_bound_lower(8, 3)</span>
<span class=sd>    1</span>

<span class=sd>    >>> _int_root_bound_lower(8, 2)</span>
<span class=sd>    2</span>

<span class=sd>    >>> _int_root_bound_lower(25, 3)</span>
<span class=sd>    1</span>
<span class=sd>    """</span>
    <span class=n>logdiv</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>base</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>//</span> <span class=n>root</span>
    <span class=k>return</span> <span class=p>(</span><span class=mi>1</span> <span class=o><<</span> <span class=p>(</span><span class=n>logdiv</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span> <span class=k>if</span> <span class=n>logdiv</span> <span class=o>></span> <span class=mi>0</span> <span class=k>else</span> <span class=p>(</span><span class=mi>0</span> <span class=k>if</span> <span class=n>base</span> <span class=o><</span> <span class=mi>1</span> <span class=k>else</span> <span class=mi>1</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>_int_root_bound_upper</span><span class=p>(</span><span class=n>base</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>root</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Compute an upper bound for a root.</span>

<span class=sd>    :param base: the base number</span>
<span class=sd>    :param root: the root</span>
<span class=sd>    :returns: the upper bound</span>

<span class=sd>    >>> _int_root_bound_upper(8, 3)</span>
<span class=sd>    4</span>

<span class=sd>    >>> _int_root_bound_upper(8, 2)</span>
<span class=sd>    4</span>

<span class=sd>    >>> _int_root_bound_upper(25, 3)</span>
<span class=sd>    8</span>
<span class=sd>    """</span>
    <span class=k>return</span> <span class=n>base</span> <span class=k>if</span> <span class=n>root</span> <span class=o>==</span> <span class=mi>1</span> <span class=k>else</span> <span class=nb>min</span><span class=p>(</span><span class=mi>1</span> <span class=o><<</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>ceil_div</span><span class=p>(</span>
        <span class=n>base</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>root</span><span class=p>)),</span> <span class=p>(</span><span class=n>base</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=k>if</span> <span class=n>base</span> <span class=o><</span> <span class=mi>6</span> <span class=k>else</span> <span class=mi>0</span><span class=p>))</span>


<span class=k>def</span><span class=w> </span><span class=nf>_frac_root_bound_lower</span><span class=p>(</span><span class=n>base</span><span class=p>:</span> <span class=n>Fraction</span><span class=p>,</span> <span class=n>root</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-></span> <span class=n>Fraction</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Compute a lower bound for a root.</span>

<span class=sd>    :param base: the base number</span>
<span class=sd>    :param root: the root</span>
<span class=sd>    :returns: the lower bound</span>

<span class=sd>    >>> _frac_root_bound_lower(Fraction(8), 3)</span>
<span class=sd>    Fraction(1, 1)</span>

<span class=sd>    >>> _frac_root_bound_lower(Fraction(8), 2)</span>
<span class=sd>    Fraction(2, 1)</span>

<span class=sd>    >>> _frac_root_bound_lower(Fraction(25), 3)</span>
<span class=sd>    Fraction(1, 1)</span>

<span class=sd>    >>> _frac_root_bound_lower(Fraction(3, 8), 3)</span>
<span class=sd>    Fraction(1, 2)</span>

<span class=sd>    >>> _frac_root_bound_lower(Fraction(11, 8), 2)</span>
<span class=sd>    Fraction(1, 1)</span>

<span class=sd>    >>> _frac_root_bound_lower(Fraction(11, 25), 3)</span>
<span class=sd>    Fraction(1, 2)</span>
<span class=sd>    """</span>
    <span class=k>return</span> <span class=n>_FRAC_0</span> <span class=k>if</span> <span class=n>base</span> <span class=o><=</span> <span class=n>_FRAC_0</span> <span class=k>else</span> <span class=p>(</span>
        <span class=n>Fraction</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>_int_root_bound_upper</span><span class=p>(</span><span class=n>ceil_div</span><span class=p>(</span>
            <span class=n>base</span><span class=o>.</span><span class=n>denominator</span><span class=p>,</span> <span class=n>base</span><span class=o>.</span><span class=n>numerator</span><span class=p>),</span> <span class=n>root</span><span class=p>))</span>
        <span class=k>if</span> <span class=n>base</span> <span class=o><</span> <span class=n>_FRAC_1</span> <span class=k>else</span> <span class=p>(</span>
            <span class=n>_FRAC_1</span> <span class=k>if</span> <span class=n>base</span> <span class=o>==</span> <span class=n>_FRAC_1</span> <span class=k>else</span> <span class=n>Fraction</span><span class=p>(</span>
                <span class=n>_int_root_bound_lower</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>base</span><span class=p>),</span> <span class=n>root</span><span class=p>))))</span>


<span class=k>def</span><span class=w> </span><span class=nf>_frac_root_bound_upper</span><span class=p>(</span><span class=n>base</span><span class=p>:</span> <span class=n>Fraction</span><span class=p>,</span> <span class=n>root</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-></span> <span class=n>Fraction</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Compute an upper bound for a root.</span>

<span class=sd>    :param base: the base number</span>
<span class=sd>    :param root: the root</span>
<span class=sd>    :returns: the upper bound</span>

<span class=sd>    >>> _frac_root_bound_upper(Fraction(8), 3)</span>
<span class=sd>    Fraction(4, 1)</span>

<span class=sd>    >>> _frac_root_bound_upper(Fraction(8), 2)</span>
<span class=sd>    Fraction(4, 1)</span>

<span class=sd>    >>> _frac_root_bound_upper(Fraction(25), 3)</span>
<span class=sd>    Fraction(8, 1)</span>

<span class=sd>    >>> _frac_root_bound_upper(Fraction(3, 8), 3)</span>
<span class=sd>    Fraction(1, 1)</span>

<span class=sd>    >>> _frac_root_bound_upper(Fraction(11, 8), 2)</span>
<span class=sd>    Fraction(2, 1)</span>

<span class=sd>    >>> _frac_root_bound_upper(Fraction(11, 25), 3)</span>
<span class=sd>    Fraction(1, 1)</span>
<span class=sd>    """</span>
    <span class=k>return</span> <span class=n>_FRAC_0</span> <span class=k>if</span> <span class=n>base</span> <span class=o><=</span> <span class=n>_FRAC_0</span> <span class=k>else</span> <span class=p>(</span>
        <span class=n>Fraction</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>_int_root_bound_lower</span><span class=p>(</span>
            <span class=n>base</span><span class=o>.</span><span class=n>denominator</span> <span class=o>//</span> <span class=n>base</span><span class=o>.</span><span class=n>numerator</span><span class=p>,</span> <span class=n>root</span><span class=p>))</span>
        <span class=k>if</span> <span class=n>base</span> <span class=o><</span> <span class=n>_FRAC_1</span> <span class=k>else</span> <span class=p>(</span>
            <span class=n>_FRAC_1</span> <span class=k>if</span> <span class=n>base</span> <span class=o>==</span> <span class=n>_FRAC_1</span> <span class=k>else</span> <span class=n>Fraction</span><span class=p>(</span>
                <span class=n>_int_root_bound_upper</span><span class=p>(</span><span class=n>ceil</span><span class=p>(</span><span class=n>base</span><span class=p>),</span> <span class=n>root</span><span class=p>))))</span>


<span class=k>def</span><span class=w> </span><span class=nf>_limited_root</span><span class=p>(</span><span class=n>base</span><span class=p>:</span> <span class=n>Fraction</span><span class=p>,</span> <span class=n>root</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
                  <span class=n>mini</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>=</span> <span class=n>_FRAC_0</span><span class=p>,</span>
                  <span class=n>maxi</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Try to compute a root at a precision so exact that no digits are lost.</span>

<span class=sd>    :param base: the base</span>
<span class=sd>    :param root: the exponent</span>
<span class=sd>    :param mini: a limit for the smallest possible result</span>
<span class=sd>    :param maxi: a maximum value, the limit for the largest possible result,</span>
<span class=sd>        or `None` if no upper limit is known</span>
<span class=sd>    :returns: the power</span>

<span class=sd>    >>> from math import sqrt</span>
<span class=sd>    >>> sqrt(3)</span>
<span class=sd>    1.7320508075688772</span>
<span class=sd>    >>> _limited_root(Fraction(3, 1), 2)</span>
<span class=sd>    1.7320508075688772</span>
<span class=sd>    >>> _limited_root(Fraction(4, 1), 2)</span>
<span class=sd>    2</span>

<span class=sd>    >>> _limited_root(Fraction(3 ** 3, 1), 3)</span>
<span class=sd>    3</span>
<span class=sd>    >>> type(_limited_root(Fraction(3 ** 3, 1), 3))</span>
<span class=sd>    &LTclass 'int'></span>

<span class=sd>    >>> _limited_root(Fraction(3 ** 333, 1), 333)</span>
<span class=sd>    3</span>

<span class=sd>    >>> _limited_root(Fraction(9000 ** 1000, 1), 1000)</span>
<span class=sd>    9000</span>

<span class=sd>    >>> _limited_root(Fraction((10 ** 8) ** 100, 1), 35)</span>
<span class=sd>    71968567300115201992879</span>

<span class=sd>    >>> 0.456 ** (1 / 25)</span>
<span class=sd>    0.9690776862089129</span>
<span class=sd>    >>> _limited_root(Fraction(456, 1000), 25)</span>
<span class=sd>    0.9690776862089129</span>

<span class=sd>    >>> _limited_root(Fraction(2, 1), 2)</span>
<span class=sd>    1.4142135623730951</span>
<span class=sd>    >>> sqrt(2)</span>
<span class=sd>    1.4142135623730951</span>
<span class=sd>    """</span>
    <span class=n>lower</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>upper</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>base</span><span class=o>.</span><span class=n>denominator</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>ibase</span> <span class=o>=</span> <span class=n>base</span><span class=o>.</span><span class=n>numerator</span>
        <span class=k>if</span> <span class=n>ibase</span> <span class=o><=</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>ibase</span>

        <span class=n>ilower</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>mini</span><span class=p>),</span> <span class=n>_int_root_bound_lower</span><span class=p>(</span><span class=n>ibase</span><span class=p>,</span> <span class=n>root</span><span class=p>))</span>
        <span class=n>iupper</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>_int_root_bound_upper</span><span class=p>(</span><span class=n>ibase</span><span class=p>,</span> <span class=n>root</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>maxi</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>iupper</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>maxi</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>iupper</span><span class=p>)</span>
        <span class=n>imid</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>ilower</span>
        <span class=k>while</span> <span class=n>ilower</span> <span class=o><=</span> <span class=n>iupper</span><span class=p>:</span>
            <span class=n>imid</span> <span class=o>=</span> <span class=p>(</span><span class=n>ilower</span> <span class=o>+</span> <span class=n>iupper</span><span class=p>)</span> <span class=o>>></span> <span class=mi>1</span>
            <span class=n>imid_exp</span> <span class=o>=</span> <span class=n>imid</span> <span class=o>**</span> <span class=n>root</span>
            <span class=k>if</span> <span class=n>imid_exp</span> <span class=o>></span> <span class=n>ibase</span><span class=p>:</span>
                <span class=n>iupper</span> <span class=o>=</span> <span class=n>imid</span> <span class=o>-</span> <span class=mi>1</span>
            <span class=k>elif</span> <span class=n>imid_exp</span> <span class=o><</span> <span class=n>ibase</span><span class=p>:</span>
                <span class=n>ilower</span> <span class=o>=</span> <span class=n>imid</span> <span class=o>+</span> <span class=mi>1</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>imid</span>  <span class=c1># We got an exact integer result</span>
        <span class=c1># No exact integer result, but at least new limits</span>
        <span class=n>upper</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>imid</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
        <span class=n>lower</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>imid</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>

    <span class=c1># Now we do binary search using fractions</span>
    <span class=k>if</span> <span class=n>upper</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>upper</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>base</span><span class=p>,</span> <span class=n>_FRAC_1</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>maxi</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>upper</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>upper</span><span class=p>,</span> <span class=n>maxi</span><span class=p>)</span>
    <span class=n>upper</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>upper</span><span class=p>,</span> <span class=n>_frac_root_bound_upper</span><span class=p>(</span><span class=n>base</span><span class=p>,</span> <span class=n>root</span><span class=p>))</span>
    <span class=k>if</span> <span class=n>lower</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>lower</span> <span class=o>=</span> <span class=n>_FRAC_0</span>
    <span class=n>lower</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>mini</span><span class=p>,</span> <span class=n>lower</span><span class=p>)</span>
    <span class=n>lower</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>lower</span><span class=p>,</span> <span class=n>_frac_root_bound_lower</span><span class=p>(</span><span class=n>base</span><span class=p>,</span> <span class=n>root</span><span class=p>))</span>

    <span class=c1># Now compute the root using binary search within the limits.</span>
    <span class=n>guess</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>nan</span>
    <span class=n>equal_steps</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>4</span>
    <span class=k>while</span> <span class=n>equal_steps</span> <span class=o>></span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>last_guess</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>guess</span>
        <span class=n>mid</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>=</span> <span class=p>(</span><span class=n>lower</span> <span class=o>+</span> <span class=n>upper</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
        <span class=n>mid_exp</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>**</span> <span class=n>root</span>
        <span class=k>if</span> <span class=n>mid_exp</span> <span class=o>></span> <span class=n>base</span><span class=p>:</span>
            <span class=n>upper</span> <span class=o>=</span> <span class=n>mid</span>
        <span class=k>elif</span> <span class=n>mid_exp</span> <span class=o><</span> <span class=n>base</span><span class=p>:</span>
            <span class=n>lower</span> <span class=o>=</span> <span class=n>mid</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>_from_frac</span><span class=p>(</span><span class=n>mid</span><span class=p>)</span>

        <span class=n>guess</span> <span class=o>=</span> <span class=n>_from_frac</span><span class=p>(</span><span class=n>mid</span><span class=p>)</span>
        <span class=k>if</span> <span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>guess</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>type</span><span class=p>(</span><span class=n>last_guess</span><span class=p>))</span> <span class=ow>and</span> <span class=p>(</span><span class=n>guess</span> <span class=o>==</span> <span class=n>last_guess</span><span class=p>):</span>
            <span class=n>equal_steps</span> <span class=o>-=</span> <span class=mi>1</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>equal_steps</span> <span class=o>=</span> <span class=mi>4</span>
    <span class=k>return</span> <span class=n>guess</span>


<div class=viewcode-block id=SampleStatistics>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics>[docs]</a>
<span class=nd>@dataclass</span><span class=p>(</span><span class=n>frozen</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>init</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>eq</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<span class=k>class</span><span class=w> </span><span class=nc>SampleStatistics</span><span class=p>(</span><span class=n>StreamStatistics</span><span class=p>):</span>
<span class=w>    </span><span class=sd>"""An immutable record with sample statistics of one quantity."""</span>

    <span class=c1>#: The median, i.e., the value in the middle of the sorted list of</span>
    <span class=c1>#: :attr:`~pycommons.math.stream_statistics.StreamStatistics.n` data</span>
    <span class=c1># samples.</span>
    <span class=n>median</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span>
    <span class=c1>#: The geometric mean value, if defined. This is the</span>
    <span class=c1>#: :attr:`~pycommons.math.stream_statistics.StreamStatistics.n`-th root</span>
    <span class=c1>#: of the product of all data samples.</span>
    <span class=c1>#: This value will be `None` if there was any sample which is not greater</span>
    <span class=c1>#: than 0.</span>
    <span class=n>mean_geom</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>minimum</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=n>median</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span>
                 <span class=n>mean_arith</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=n>mean_geom</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span><span class=p>,</span>
                 <span class=n>maximum</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=n>stddev</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span><span class=p>):</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Create a sample statistics record.</span>

<span class=sd>        :param n: the sample size, must be `n >= 1`</span>
<span class=sd>        :param minimum: the minimum</span>
<span class=sd>        :param median: the median</span>
<span class=sd>        :param mean_arith: the arithmetic mean</span>
<span class=sd>        :param mean_geom: the geometric mean, or `None` if it is undefined</span>
<span class=sd>        :param maximum: the maximum</span>
<span class=sd>        :param stddev: the standard deviation, must be `None` if `n == 0`</span>

<span class=sd>        >>> s1 = SampleStatistics(2, 1, 2, 4.0, 3, 6, 0.2)</span>
<span class=sd>        >>> s1.n</span>
<span class=sd>        2</span>
<span class=sd>        >>> s1.minimum</span>
<span class=sd>        1</span>
<span class=sd>        >>> s1.median</span>
<span class=sd>        2</span>
<span class=sd>        >>> s1.mean_arith</span>
<span class=sd>        4</span>
<span class=sd>        >>> s1.mean_geom</span>
<span class=sd>        3</span>
<span class=sd>        >>> s1.maximum</span>
<span class=sd>        6</span>
<span class=sd>        >>> s1.stddev</span>
<span class=sd>        0.2</span>
<span class=sd>        >>> hash(s1)</span>
<span class=sd>        8839096310731950625</span>

<span class=sd>        >>> s2 = SampleStatistics(1, 0, 0.0, 0, None, 0.0, None)</span>
<span class=sd>        >>> s2.n</span>
<span class=sd>        1</span>
<span class=sd>        >>> s2.minimum</span>
<span class=sd>        0</span>
<span class=sd>        >>> s2.median</span>
<span class=sd>        0</span>
<span class=sd>        >>> s2.mean_arith</span>
<span class=sd>        0</span>
<span class=sd>        >>> print(s2.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s2.maximum</span>
<span class=sd>        0</span>
<span class=sd>        >>> print(s2.stddev)</span>
<span class=sd>        None</span>
<span class=sd>        >>> hash(s2) == hash((0, 0, 0, inf, 0, inf, 1, 1))</span>
<span class=sd>        True</span>

<span class=sd>        >>> s3 = SampleStatistics(n=3, minimum=5, median=5, maximum=5,</span>
<span class=sd>        ...                       mean_arith=5, mean_geom=5, stddev=0.0)</span>
<span class=sd>        >>> s3.stddev</span>
<span class=sd>        0</span>
<span class=sd>        >>> hash(s3)</span>
<span class=sd>        1175763770956004139</span>

<span class=sd>        >>> sset = {s1, s1, s2, s1, s3, s3, s2, s1}</span>
<span class=sd>        >>> len(sset)</span>
<span class=sd>        3</span>
<span class=sd>        >>> print(list(sss.n for sss in sorted(sset)))</span>
<span class=sd>        [1, 2, 3]</span>
<span class=sd>        >>> print(list(sss.minimum for sss in sorted(sset)))</span>
<span class=sd>        [0, 1, 5]</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=1, minimum=5, median=6, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=5, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        median (6) must equal minimum (5) if n=1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=2, minimum=5, median=4, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=5, stddev=0)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        median (4) must be >= minimum (5) if n>1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=1, minimum=5, median=5, maximum=6,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=5, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        maximum (6) must equal minimum (5) if n=1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=2, minimum=5, median=6, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=5, stddev=0)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        maximum (5) must be >= med (6) if n>1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=1, minimum=5, median=5, maximum=5,</span>
<span class=sd>        ...                      mean_arith=4, mean_geom=5, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        mean_arith (4) must equal minimum (5) if n=1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=2, minimum=5, median=6, maximum=6,</span>
<span class=sd>        ...                      mean_arith=4, mean_geom=5, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        minimum<=mean_arith<=maximum must hold, but got 5, 4, and 6.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=1, minimum=5, median=5, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=None, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        If minimum (5) > 0, then mean_geom must be defined, but it is None.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=1, minimum=0, median=0, maximum=0,</span>
<span class=sd>        ...                      mean_arith=0, mean_geom=0, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        If minimum (0) <= 0, then mean_geom is undefined, but it is 0.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=1, minimum=5, median=5, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=6, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        mean_geom (6) must equal minimum (5) if n=1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=3, minimum=5, median=6, maximum=7,</span>
<span class=sd>        ...                      mean_arith=6, mean_geom=6.1, stddev=1)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        mean_geom (6.1) must be <= mean_arith (6).</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=3, minimum=5, median=6, maximum=7,</span>
<span class=sd>        ...                      mean_arith=6, mean_geom=6, stddev=-1)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        stddev must be >= 0, but is -1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=3, minimum=5, median=6, maximum=7,</span>
<span class=sd>        ...                      mean_arith=6, mean_geom=6, stddev=0)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(str(ve)[:59])</span>
<span class=sd>        If stddev (0) is 0, then minimum (5) must equal maximum (7)</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=3, minimum=5, median=5, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=5, stddev=1)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(str(ve)[:59])</span>
<span class=sd>        If stddev (1) is 0, then minimum (5) must equal maximum (5)</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=3, minimum=5, median=5, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=5, stddev=None)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        If n=1, stddev=None and vice versa, but got n=3 and stddev=None.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=1, minimum=5, median=5, maximum=5,</span>
<span class=sd>        ...                      mean_arith=5, mean_geom=5, stddev=1)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        If n=1, stddev=None and vice versa, but got n=1 and stddev=1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics(n=2, minimum=5, median=5, maximum=6,</span>
<span class=sd>        ...                      mean_arith=6, mean_geom=7, stddev=1)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        minimum<=mean_geom<=maximum must hold, but got 5, 7, and 6.</span>
<span class=sd>        """</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>minimum</span><span class=p>,</span> <span class=n>mean_arith</span><span class=p>,</span> <span class=n>maximum</span><span class=p>,</span> <span class=n>stddev</span><span class=p>)</span>

        <span class=c1># check minimum</span>
        <span class=n>median</span> <span class=o>=</span> <span class=n>try_int</span><span class=p>(</span><span class=n>median</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>n</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>median</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"median (</span><span class=si>{</span><span class=n>median</span><span class=si>}</span><span class=s2>) must equal "</span>
                                 <span class=sa>f</span><span class=s2>"minimum (</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=si>}</span><span class=s2>) if n=1."</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>median</span> <span class=o><</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"median (</span><span class=si>{</span><span class=n>median</span><span class=si>}</span><span class=s2>) must be >= minimum ("</span>
                             <span class=sa>f</span><span class=s2>"</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=si>}</span><span class=s2>) if n>1."</span><span class=p>)</span>

        <span class=c1># check maximum</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>maximum</span> <span class=o><</span> <span class=n>median</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>"maximum (</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>maximum</span><span class=si>}</span><span class=s2>) must be >= med (</span><span class=si>{</span><span class=n>median</span><span class=si>}</span><span class=s2>) if n>1."</span><span class=p>)</span>

        <span class=c1># check geometric mean</span>
        <span class=k>if</span> <span class=n>mean_geom</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span> <span class=o>></span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>"If minimum (</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=si>}</span><span class=s2>) > 0, then mean_geom must be"</span>
                    <span class=sa>f</span><span class=s2>" defined, but it is </span><span class=si>{</span><span class=n>mean_geom</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span> <span class=o><=</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>"If minimum (</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=si>}</span><span class=s2>) <= 0, then mean_geom is "</span>
                    <span class=sa>f</span><span class=s2>"undefined, but it is </span><span class=si>{</span><span class=n>mean_geom</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
            <span class=n>mean_geom</span> <span class=o>=</span> <span class=n>try_int</span><span class=p>(</span><span class=n>mean_geom</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>n</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>mean_geom</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"mean_geom (</span><span class=si>{</span><span class=n>mean_geom</span><span class=si>}</span><span class=s2>) must equal "</span>
                                     <span class=sa>f</span><span class=s2>"minimum (</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=si>}</span><span class=s2>) if n=1."</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span> <span class=o><=</span> <span class=n>mean_geom</span> <span class=o><=</span> <span class=bp>self</span><span class=o>.</span><span class=n>maximum</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                        <span class=s2>"minimum<=mean_geom<=maximum must hold, but got "</span>
                        <span class=sa>f</span><span class=s2>"</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>mean_geom</span><span class=si>}</span><span class=s2>, and </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>maximum</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>mean_geom</span> <span class=o>></span> <span class=bp>self</span><span class=o>.</span><span class=n>mean_arith</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>"mean_geom (</span><span class=si>{</span><span class=n>mean_geom</span><span class=si>}</span><span class=s2>) must be <= "</span>
                        <span class=sa>f</span><span class=s2>"mean_arith (</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>mean_arith</span><span class=si>}</span><span class=s2>)."</span><span class=p>)</span>

        <span class=nb>object</span><span class=o>.</span><span class=fm>__setattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>"median"</span><span class=p>,</span> <span class=n>median</span><span class=p>)</span>
        <span class=nb>object</span><span class=o>.</span><span class=fm>__setattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>"mean_geom"</span><span class=p>,</span> <span class=n>mean_geom</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Get a string representation of this object.</span>

<span class=sd>        :returns: the string</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=n>CSV_SEPARATOR</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>n</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>median</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>mean_arith</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>mean_geom</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>maximum</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>stddev</span><span class=p>)))</span>

<div class=viewcode-block id=SampleStatistics.min_mean>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.min_mean>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>min_mean</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Obtain the smallest of the three mean values.</span>

<span class=sd>        :returns: the smallest of `mean_arith`, `mean_geom`, and `median`</span>

<span class=sd>        >>> SampleStatistics(1, 0, 0.0, 0, None, 0.0, None).min_mean()</span>
<span class=sd>        0</span>
<span class=sd>        >>> SampleStatistics(2, 1, 2, 4.0, 3, 6, 0.2).min_mean()</span>
<span class=sd>        2</span>
<span class=sd>        >>> SampleStatistics(2, 1, 3.2, 4.0, 3, 6, 0.2).min_mean()</span>
<span class=sd>        3</span>
<span class=sd>        >>> SampleStatistics(2, 1, 5.2, 4.0, 3, 6, 0.2).min_mean()</span>
<span class=sd>        3</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>mean_geom</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># geometric mean is always <= arithmean</span>
            <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>mean_arith</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>median</span><span class=p>)</span>
        <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>mean_geom</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>median</span><span class=p>)</span></div>


<div class=viewcode-block id=SampleStatistics.max_mean>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.max_mean>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>max_mean</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Obtain the largest of the three mean values.</span>

<span class=sd>        :returns: the largest of `mean_arith`, `mean_geom`, and `median`</span>

<span class=sd>        >>> SampleStatistics(1, 0, 0.0, 0, None, 0.0, None).max_mean()</span>
<span class=sd>        0</span>
<span class=sd>        >>> SampleStatistics(2, 1, 2, 4.0, 3, 6, 0.2).max_mean()</span>
<span class=sd>        4</span>
<span class=sd>        >>> SampleStatistics(2, 1, 3.2, 4.0, 3, 6, 0.2).max_mean()</span>
<span class=sd>        4</span>
<span class=sd>        >>> SampleStatistics(2, 1, 5.2, 4.0, 3, 6, 0.2).max_mean()</span>
<span class=sd>        5.2</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>mean_arith</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>median</span><span class=p>)</span></div>


<div class=viewcode-block id=SampleStatistics.compact>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.compact>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>compact</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>needs_n</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> \
            <span class=o>-></span> <span class=s2>"int | float | SampleStatistics"</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Try to represent this object as single number, if possible.</span>

<span class=sd>        :param needs_n: if this is `True`, the default, then the object is</span>
<span class=sd>            only turned into a single number if alsp `n==1`. Otherwise, `n`</span>
<span class=sd>            is ignored</span>
<span class=sd>        :returns: an integer or float if this objects minimum equals its</span>
<span class=sd>            maximum, the object itself otherwise</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(10, 1)</span>
<span class=sd>        >>> s.compact() == 10</span>
<span class=sd>        True</span>
<span class=sd>        >>> s.compact() == s.compact(True)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(10, 2)</span>
<span class=sd>        >>> s.compact() is s</span>
<span class=sd>        True</span>
<span class=sd>        >>> s.compact() == s.compact(True)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(10, 2)</span>
<span class=sd>        >>> s.compact(False) == 10</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics(2, 1, 2, 4, 3, 5, 3)</span>
<span class=sd>        >>> s.compact() is s</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics(2, 1, 2, 4, 3, 5, 3)</span>
<span class=sd>        >>> s.compact(False) is s</span>
<span class=sd>        True</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     s.compact(1)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(te)</span>
<span class=sd>        needs_n should be an instance of bool but is int, namely 1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     s.compact(None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(te)</span>
<span class=sd>        needs_n should be an instance of bool but is None.</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>needs_n</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=n>needs_n</span><span class=p>,</span> <span class=s2>"needs_n"</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
        <span class=n>mi</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>minimum</span>
        <span class=k>return</span> <span class=bp>self</span> <span class=k>if</span> <span class=p>(</span><span class=n>mi</span> <span class=o><</span> <span class=bp>self</span><span class=o>.</span><span class=n>maximum</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span>
            <span class=n>needs_n</span> <span class=ow>and</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n</span> <span class=o>></span> <span class=mi>1</span><span class=p>))</span> <span class=k>else</span> <span class=n>mi</span></div>


    <span class=k>def</span><span class=w> </span><span class=nf>_key</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span>
                            <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
<span class=w>        </span><span class=sa>r</span><span class=sd>"""</span>
<span class=sd>        Get a comparison and hash key.</span>

<span class=sd>        :returns: the comparison key</span>

<span class=sd>        >>> SampleStatistics(2, 1, 2, 4.0, 3, 6, 0.2)._key()</span>
<span class=sd>        (1, 2, 4, 3, 6, 0.2, 2, 1)</span>

<span class=sd>        >>> SampleStatistics(1, 0, 0, 0, None, 0, None)._key()</span>
<span class=sd>        (0, 0, 0, inf, 0, inf, 1, 1)</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>minimum</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>median</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>mean_arith</span><span class=p>,</span>
                <span class=n>inf</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>mean_geom</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>mean_geom</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>maximum</span><span class=p>,</span> <span class=n>inf</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>stddev</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>stddev</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>n</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

<div class=viewcode-block id=SampleStatistics.get_mean_geom>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.get_mean_geom>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>get_mean_geom</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Get the geometric mean (:attr:`~SampleStatistics.mean_geom`).</span>

<span class=sd>        :returns: the geometric mean (:attr:`~SampleStatistics.mean_geom`) of</span>
<span class=sd>            all the samples, `None` if the geometric mean is not defined.</span>
<span class=sd>        :raises TypeError: if an object of the wrong type is passed in as self</span>

<span class=sd>        >>> SampleStatistics(5, 3, 5, 6, 4, 7, 2).get_mean_geom()</span>
<span class=sd>        4</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.get_mean_geom(None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(str(te)[:20])</span>
<span class=sd>        self should be an in</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>SampleStatistics</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>"self"</span><span class=p>,</span> <span class=n>SampleStatistics</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>mean_geom</span></div>


<div class=viewcode-block id=SampleStatistics.get_median>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.get_median>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>get_median</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Get the :attr:`~SampleStatistics.median` of all the samples.</span>

<span class=sd>        :returns: the :attr:`~SampleStatistics.median` of all the samples.</span>
<span class=sd>        :raises TypeError: if an object of the wrong type is passed in as self</span>

<span class=sd>        >>> SampleStatistics(5, 3, 5, 6, 4, 7, 2).get_median()</span>
<span class=sd>        5</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.get_median(None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(str(te)[:20])</span>
<span class=sd>        self should be an in</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>SampleStatistics</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>"self"</span><span class=p>,</span> <span class=n>SampleStatistics</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>median</span></div>


<div class=viewcode-block id=SampleStatistics.from_single_value>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.from_single_value>[docs]</a>
    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>from_single_value</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span>
            <span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=s2>"StreamStatistics"</span><span class=p>],</span> <span class=n>n</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span> <span class=o>-></span> <span class=s2>"SampleStatistics"</span><span class=p>:</span>
<span class=w>        </span><span class=sa>r</span><span class=sd>"""</span>
<span class=sd>        Create a sample statistics from a single number.</span>

<span class=sd>        :param value: the single value</span>
<span class=sd>        :param n: the number of samples, i.e., the number of times this value</span>
<span class=sd>            occurred</span>
<span class=sd>        :returns: the sample statistics</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(10, 2)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.mean_geom \</span>
<span class=sd>        ...     == s.median == 10</span>
<span class=sd>        True</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(10, 1)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.mean_geom \</span>
<span class=sd>        ...     == s.median == 10</span>
<span class=sd>        True</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(-10, 2)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.median == -10</span>
<span class=sd>        True</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(-10, 1)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.median == -10</span>
<span class=sd>        True</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(10.5, 2)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.mean_geom \</span>
<span class=sd>        ...     == s.median == 10.5</span>
<span class=sd>        True</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(10.5, 1)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.mean_geom \</span>
<span class=sd>        ...     == s.median == 10.5</span>
<span class=sd>        True</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(-10.5, 2)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.median == -10.5</span>
<span class=sd>        True</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> s = SampleStatistics.from_single_value(-10.5, 1)</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.minimum == s.maximum == s.mean_arith == s.median == -10.5</span>
<span class=sd>        True</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s is SampleStatistics.from_single_value(s, s.n)</span>
<span class=sd>        True</span>

<span class=sd>        >>> print(SampleStatistics.from_single_value(</span>
<span class=sd>        ...     StreamStatistics(5, 1, 1, 1, 0), 5))</span>
<span class=sd>        5;1;1;1;1;1;0</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_single_value(StreamStatistics(</span>
<span class=sd>        ...         5, 1, 2, 3, 5), 5)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        Cannot create SampleStatistics from 5;1;2;3;5.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_single_value(None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(str(te)[:20])</span>
<span class=sd>        value should be an i</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_single_value("a")</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(str(te)[:20])</span>
<span class=sd>        value should be an i</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_single_value(1, None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(str(te)[:20])</span>
<span class=sd>        n should be an insta</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_single_value(1, "a")</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(str(te)[:20])</span>
<span class=sd>        n should be an insta</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_single_value(s, 12)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(str(ve)[:20])</span>
<span class=sd>        Incompatible numbers</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_single_value(inf)</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(str(ve)[:20])</span>
<span class=sd>        value=inf is not fin</span>
<span class=sd>        """</span>
        <span class=n>n</span> <span class=o>=</span> <span class=n>check_int_range</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=s2>"n"</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1_000_000_000_000_000_000</span><span class=p>)</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>StreamStatistics</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>n</span> <span class=o>!=</span> <span class=n>n</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>  <span class=c1># noqa: TRY004</span>
                    <span class=sa>f</span><span class=s2>"Incompatible numbers of values </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=s2> and </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>SampleStatistics</span><span class=p>):</span>
                <span class=k>return</span> <span class=n>value</span>
            <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>maximum</span> <span class=o>!=</span> <span class=n>value</span><span class=o>.</span><span class=n>minimum</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>"Cannot create SampleStatistics from </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
            <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>maximum</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=s2>"value"</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=n>SampleStatistics</span><span class=p>))</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>isfinite</span><span class=p>(</span><span class=n>value</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"value=</span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> is not finite."</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>SampleStatistics</span><span class=p>(</span>
            <span class=n>n</span><span class=o>=</span><span class=n>n</span><span class=p>,</span> <span class=n>minimum</span><span class=o>=</span><span class=n>value</span><span class=p>,</span> <span class=n>median</span><span class=o>=</span><span class=n>value</span><span class=p>,</span> <span class=n>mean_arith</span><span class=o>=</span><span class=n>value</span><span class=p>,</span>
            <span class=n>mean_geom</span><span class=o>=</span><span class=kc>None</span> <span class=k>if</span> <span class=n>value</span> <span class=o><=</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>value</span><span class=p>,</span> <span class=n>maximum</span><span class=o>=</span><span class=n>value</span><span class=p>,</span>
            <span class=n>stddev</span><span class=o>=</span><span class=kc>None</span> <span class=k>if</span> <span class=n>n</span> <span class=o><=</span> <span class=mi>1</span> <span class=k>else</span> <span class=mi>0</span><span class=p>)</span></div>


<div class=viewcode-block id=SampleStatistics.aggregate>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.aggregate>[docs]</a>
    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>aggregate</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span> <span class=o>-></span> <span class=n>StreamStatisticsAggregate</span><span class=p>[</span><span class=s2>"SampleStatistics"</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Get an aggregate suitable for this statistics type.</span>

<span class=sd>        :return: the aggregate</span>

<span class=sd>        >>> ag = SampleStatistics.aggregate()</span>
<span class=sd>        >>> ag.update((1, 2, 3, 4))</span>
<span class=sd>        >>> ag.result()</span>
<span class=sd>        SampleStatistics(n=4, minimum=1, mean_arith=2.5, maximum=4, \</span>
<span class=sd>stddev=1.2909944487358056, median=2.5, mean_geom=2.213363839400643)</span>
<span class=sd>        >>> ag.reset()</span>
<span class=sd>        >>> ag.add(4)</span>
<span class=sd>        >>> ag.add(5)</span>
<span class=sd>        >>> ag.add(6)</span>
<span class=sd>        >>> ag.add(7)</span>
<span class=sd>        >>> ag.result()</span>
<span class=sd>        SampleStatistics(n=4, minimum=4, mean_arith=5.5, maximum=7, \</span>
<span class=sd>stddev=1.2909944487358056, median=5.5, mean_geom=5.383563270955295)</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=n>_SampleStats</span><span class=p>()</span></div>


<div class=viewcode-block id=SampleStatistics.from_samples>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.SampleStatistics.from_samples>[docs]</a>
    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>from_samples</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>source</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span>
            <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span><span class=p>])</span> <span class=o>-></span> <span class=s2>"SampleStatistics"</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Create a statistics object from an iterable of integers or floats.</span>

<span class=sd>        As bottom line, this function will forward computations to the</span>
<span class=sd>        :mod:`statistics` routines that ship with Python if nothing else works.</span>
<span class=sd>        However, sometimes, something else may work: In particular, if the data</span>
<span class=sd>        consists of only integers. In this case, it just might be possible to</span>
<span class=sd>        compute the statistics very accurately with integer precision, where</span>
<span class=sd>        possible. Also, otherwise, we can often accummulate the data using</span>
<span class=sd>        instances of :class:`fractions.Fraction`. Indeed, even the</span>
<span class=sd>        :mod:`statistics` routines may do this, but they convert to `float` in</span>
<span class=sd>        cases of non-1 denominators, even if the integer presentation was much</span>
<span class=sd>        more accurate.</span>

<span class=sd>        :param source: the source</span>
<span class=sd>        :returns: a statistics representing the statistics over `source`</span>

<span class=sd>        >>> s = SampleStatistics.from_samples([0.0])</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        0</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        0</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        0</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        None</span>

<span class=sd>        >>> s = SampleStatistics.from_samples([1.0])</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        1</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        1</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        None</span>

<span class=sd>        >>> s = SampleStatistics.from_samples([1.0, 1])</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        2</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        1</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        1</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0</span>

<span class=sd>        >>> s = SampleStatistics.from_samples([0, 0.0])</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        2</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        0</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        0</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        0</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0</span>

<span class=sd>        >>> from statistics import stdev as stat_stddev</span>
<span class=sd>        >>> dd = [1.5, 2.5]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        2</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        1.5</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        2.5</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        1.9364916731037085</span>
<span class=sd>        >>> stat_geomean(dd)</span>
<span class=sd>        1.9364916731037085</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        2</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0.7071067811865476</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        0.7071067811865476</span>

<span class=sd>        >>> dd = [1.0, 2.0]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        2</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        2</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        1.4142135623730951</span>
<span class=sd>        >>> (1 * 2) ** 0.5</span>
<span class=sd>        1.4142135623730951</span>
<span class=sd>        >>> stat_geomean(dd)</span>
<span class=sd>        1.414213562373095</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        1.5</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        0.7071067811865476</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        0.7071067811865476</span>

<span class=sd>        >>> dd = [1.0, 2.0, 3.0]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        3</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        1</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        3</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        1.8171205928321397</span>
<span class=sd>        >>> (1 * 2 * 3) ** (1 / 3)</span>
<span class=sd>        1.8171205928321397</span>
<span class=sd>        >>> stat_geomean(dd)</span>
<span class=sd>        1.8171205928321397</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        2</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        1</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        1.0</span>

<span class=sd>        >>> dd = [1.0, 0, 3.0]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        3</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        0</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        3</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        1</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        1.5275252316519468</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        1.5275252316519468</span>

<span class=sd>        >>> dd = [1.0, -2, 3.0]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        3</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        -2</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        3</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        None</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        1</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        2.516611478423583</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        2.516611478423583</span>

<span class=sd>        >>> dd = [1e5, 2e7, 3e9]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        3</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        100000</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        3000000000</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        18171205.928321395</span>
<span class=sd>        >>> (100000 * 20000000 * 3000000000) ** (1 / 3)</span>
<span class=sd>        18171205.92832138</span>
<span class=sd>        >>> 100000 * (((100000 // 100000) * (20000000 // 100000) * (</span>
<span class=sd>        ...     3000000000 // 100000)) ** (1 / 3))</span>
<span class=sd>        18171205.92832139</span>
<span class=sd>        >>> print(s.mean_geom ** 3)</span>
<span class=sd>        5.999999999999999e+21</span>
<span class=sd>        >>> print(18171205.92832139 ** 3)</span>
<span class=sd>        5.999999999999995e+21</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        20000000</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        1726277112.7487035</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        1726277112.7487035</span>

<span class=sd>        >>> dd = [3.3, 2.5, 3.7, 4.9]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.n</span>
<span class=sd>        4</span>
<span class=sd>        >>> s.minimum</span>
<span class=sd>        2.5</span>
<span class=sd>        >>> s.maximum</span>
<span class=sd>        4.9</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        3.4971393519216964</span>
<span class=sd>        >>> 3.4971393519216964 ** 4</span>
<span class=sd>        149.5725</span>
<span class=sd>        >>> (3.3 * 2.5 * 3.7 * 4.9) ** 0.25</span>
<span class=sd>        3.497139351921697</span>
<span class=sd>        >>> s.median</span>
<span class=sd>        3.5</span>
<span class=sd>        >>> s.stddev</span>
<span class=sd>        1.0000000000000002</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        1.0000000000000002</span>

<span class=sd>        >>> dd = [3, 1, 2, 5]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.minimum)</span>
<span class=sd>        1</span>
<span class=sd>        >>> print(s.maximum)</span>
<span class=sd>        5</span>
<span class=sd>        >>> print(s.mean_arith)</span>
<span class=sd>        2.75</span>
<span class=sd>        >>> print(s.median)</span>
<span class=sd>        2.5</span>
<span class=sd>        >>> print(f"{s.mean_geom:.4f}")</span>
<span class=sd>        2.3403</span>
<span class=sd>        >>> print(f"{s.min_mean():.4f}")</span>
<span class=sd>        2.3403</span>
<span class=sd>        >>> print(f"{s.max_mean()}")</span>
<span class=sd>        2.75</span>

<span class=sd>        >>> dd = [8, 8, 8, 8, 9, 10, 10, 11, 11, 12, 12, 12, 12, 13,</span>
<span class=sd>        ...       13, 13, 14, 14, 14, 15, 15, 15, 15, 15, 15, 16, 16, 16]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.minimum)</span>
<span class=sd>        8</span>
<span class=sd>        >>> print(s.maximum)</span>
<span class=sd>        16</span>
<span class=sd>        >>> print(s.mean_arith)</span>
<span class=sd>        12.5</span>
<span class=sd>        >>> print(s.median)</span>
<span class=sd>        13</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        12.197150265022891</span>
<span class=sd>        >>> stat_geomean(dd)</span>
<span class=sd>        12.19715026502289</span>
<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        2.673602092336881</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        2.673602092336881</span>

<span class=sd>        >>> dd = [3, 4, 7, 14, 15, 16, 26, 28, 29, 30, 31, 31]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.minimum)</span>
<span class=sd>        3</span>
<span class=sd>        >>> print(s.maximum)</span>
<span class=sd>        31</span>
<span class=sd>        >>> print(s.mean_arith)</span>
<span class=sd>        19.5</span>
<span class=sd>        >>> print(s.median)</span>
<span class=sd>        21</span>

<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        15.354984483655892</span>
<span class=sd>        >>> stat_geomean(dd)</span>
<span class=sd>        15.354984483655894</span>
<span class=sd>        >>> k = 1</span>
<span class=sd>        >>> for i in dd:</span>
<span class=sd>        ...     k *= i</span>
<span class=sd>        >>> k</span>
<span class=sd>        171787904870400</span>
<span class=sd>        >>> len(dd)</span>
<span class=sd>        12</span>
<span class=sd>        >>> k ** (1 / 12)</span>
<span class=sd>        15.354984483655889</span>
<span class=sd>        >>> 15.354984483655889 ** 12</span>
<span class=sd>        171787904870399.62</span>
<span class=sd>        >>> 15.354984483655894 ** 12</span>
<span class=sd>        171787904870400.34</span>
<span class=sd>        >>> 15.354984483655892 ** 12</span>
<span class=sd>        171787904870400.1</span>

<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        10.917042556563484</span>
<span class=sd>        >>> print(str(stat_stddev(dd))[:-1])</span>
<span class=sd>        10.91704255656348</span>

<span class=sd>        >>> dd = [375977836981734264856247621159545315,</span>
<span class=sd>        ...       1041417453269301410322718941408784761,</span>
<span class=sd>        ...       2109650311556162106262064987699051941]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.minimum)</span>
<span class=sd>        375977836981734264856247621159545315</span>
<span class=sd>        >>> print(s.maximum)</span>
<span class=sd>        2109650311556162106262064987699051941</span>
<span class=sd>        >>> print(s.mean_arith)</span>
<span class=sd>        1175681867269065927147010516755794006</span>
<span class=sd>        >>> stat_mean(dd)</span>
<span class=sd>        1.1756818672690659e+36</span>
<span class=sd>        >>> print(s.median)</span>
<span class=sd>        1041417453269301410322718941408784761</span>

<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        938280139276529201997232316081385153</span>
<span class=sd>        >>> stat_geomean(dd)</span>
<span class=sd>        9.38280139276522e+35</span>

<span class=sd>        >>> str(dd[0] * dd[1] * dd[2])[:60]</span>
<span class=sd>        '826033329443972563356247815302467930409182372405786485790679'</span>
<span class=sd>        >>> str(938280139276529201997232316081385153 ** 3)[:60]</span>
<span class=sd>        '826033329443972563356247815302467929164458081790138679285598'</span>
<span class=sd>        >>> str(int(9.38280139276522e+35) ** 3)[:60]</span>
<span class=sd>        '826033329443953666416831847378532327244986484162191539691938'</span>

<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        874600058269081159245960567663054887</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        8.746000582690812e+35</span>

<span class=sd>        >>> dd = [104275295274308290135253194482044160663473778025704,</span>
<span class=sd>        ...       436826861307375084714000787588311944456580437896461,</span>
<span class=sd>        ...       482178404791292289021955619498303854464057392180997,</span>
<span class=sd>        ...       521745351662201002493923306143082542601267608373030,</span>
<span class=sd>        ...       676289718505789968602970820038005797309334755525626]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.minimum)</span>
<span class=sd>        104275295274308290135253194482044160663473778025704</span>
<span class=sd>        >>> print(s.maximum)</span>
<span class=sd>        676289718505789968602970820038005797309334755525626</span>
<span class=sd>        >>> print(s.mean_arith)</span>
<span class=sd>        444263126308193326993620745549949659898942794400364</span>
<span class=sd>        >>> stat_mean(dd)</span>
<span class=sd>        4.442631263081933e+50</span>
<span class=sd>        >>> print(s.median)</span>
<span class=sd>        482178404791292289021955619498303854464057392180997</span>

<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        378318848166864995660791573439112525534046591591759</span>
<span class=sd>        >>> stat_geomean(dd)</span>
<span class=sd>        3.78318848166862e+50</span>

<span class=sd>        >>> print(s.stddev)</span>
<span class=sd>        210311926886813737006941586539087921260462032505870</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        2.1031192688681374e+50</span>

<span class=sd>        >>> dd = [4, 5, 5, 6, 6, 6, 6, 6, 8, 8]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        5.884283961687533</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        5.884283961687533</span>

<span class=sd>        >>> dd = [4, 4, 4, 5, 5, 8]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        4.836542350243914</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        4.8365423502439135</span>

<span class=sd>        >>> dd = [2, 8, 11, 17, 26, 30, 32]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        13.327348017053906</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        13.327348017053906</span>

<span class=sd>        >>> dd = [2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        3.4710522375429465</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        3.471052237542947</span>

<span class=sd>        >>> dd = [3, 4, 4, 5, 6, 8, 8, 8, 8]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        5.653305998922543</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        5.653305998922543</span>

<span class=sd>        >>> dd = [16, 17, 19, 20, 20, 21, 22, 23, 24, 24, 25, 26, 29, 31,</span>
<span class=sd>        ...       31, 31, 32, 32, 32]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        24.419566831650357</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        24.41956683165036</span>

<span class=sd>        >>> dd = [66, 68, 69, 70, 72, 73, 73, 79, 81, 87, 94, 99, 100,</span>
<span class=sd>        ...       102, 103, 112, 118, 119, 123, 123]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        89.45680043258344</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        89.45680043258346</span>

<span class=sd>        >>> dd = [44, 63, 63, 68, 68, 68, 70, 74, 74, 80, 95, 108, 110, 128]</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> print(s.mean_geom)</span>
<span class=sd>        76.68646417360762</span>
<span class=sd>        >>> print(stat_geomean(dd))</span>
<span class=sd>        76.68646417360763</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_samples(None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(te)</span>
<span class=sd>        source should be an instance of typing.Iterable but is None.</span>

<span class=sd>        >>> SampleStatistics.from_samples((int("3432135447287235494201\</span>
<span class=sd>93506618248802478442\</span>
<span class=sd>545733127827402743350092428341563721880022852900744775368104117201410\</span>
<span class=sd>41"), int("4543178800835483269512609282884075126142677531600199807725\</span>
<span class=sd>0558561959304806690567285991174956892786401583087254156"), int("35473\</span>
<span class=sd>203294104466229269097724582630304968924904656920211268628173495602053\</span>
<span class=sd>843032960943121516556362641127137000879"))).mean_arith</span>
<span class=sd>        38408781925110551288804847071749420604746651597990567009597840581\</span>
<span class=sd>565913672301929416406528849308895284373981465359</span>

<span class=sd>        Corner cases where the standard deviation resulting from compact</span>
<span class=sd>        fractions deviates from the standard deviation resulting from</span>
<span class=sd>        normalized fractions:</span>

<span class=sd>        >>> dd = [-7.737125245533627e+25] * 28</span>
<span class=sd>        >>> dd[2] = -7.737125245533626e+25</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.stddev</span>
<span class=sd>        1623345050.6245058</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        1623345050.6245058</span>
<span class=sd>        >>> ddx = tuple(map(_to_frac, dd))</span>
<span class=sd>        >>> ds = sum(ddx)</span>
<span class=sd>        >>> dss = sum(ddy * ddy for ddy in ddx)</span>
<span class=sd>        >>> from math import sqrt</span>
<span class=sd>        >>> sqrt((dss - (ds * ds / 28)) / 27)</span>
<span class=sd>        1623345050.6245055</span>

<span class=sd>        Here the standard deviation becomes meaningless.</span>
<span class=sd>        If you compute it based on converting all values to floats, you get</span>
<span class=sd>        something like 0.435.</span>
<span class=sd>        You get the same result if you represent all values directly as</span>
<span class=sd>        Fractions.</span>
<span class=sd>        However, if you represent the float values as more compact Fractions,</span>
<span class=sd>        i.e., as Fractions that map to the exactly same floats but have smaller</span>
<span class=sd>        denominators, you get a standard deviation of 9.32+64.</span>
<span class=sd>        Basically, the difference is 65 orders of magnitude.</span>
<span class=sd>        But the source numbers would be exactly the same...</span>
<span class=sd>        The reason is the limited range of floats.</span>

<span class=sd>        >>> dd = (7.588550360256754e+81, int("75885503602567541832791480735\</span>
<span class=sd>293707\</span>
<span class=sd>29071901715047420004889892225542594864082845697"), int("758855036025675418327\</span>
<span class=sd>9148073529370729071901715047420004889892225542594864082845697"), \</span>
<span class=sd>7.588550360256754e+81, 7.588550360256754e+81, 7.588550360256754e+81, \</span>
<span class=sd>int("7588550360256754183279148073529370729071901715047420004889892225\</span>
<span class=sd>542594864082845696"), 7.588550360256754e+81, 7.588550360256754e+81, \</span>
<span class=sd>7.588550360256754e+81, 7.588550360256754e+81, int("758855036025675418\</span>
<span class=sd>3279148073529370729071901715047420004889892225542594864082845696"), int("7588\</span>
<span class=sd>55036025675418327914807352937072907190171504742000488989222554259486408284569\</span>
<span class=sd>7"), int("7588550360256754183279148073529370729071901715047420004889892225542\</span>
<span class=sd>594864082845696"), int("75885503602567541832791480735293707290719017150474200\</span>
<span class=sd>04889892225542594864082845696"), int("758855036025675418327914807352937072907\</span>
<span class=sd>1901715047420004889892225542594864082845697"), 7.588550360256754e+81,\</span>
<span class=sd>int("7588550360256754183279148073529370729071901715047420004889892225\</span>
<span class=sd>542594864082845697"), int("75885503602567541832791480735293707290719017150474\</span>
<span class=sd>20004889892225542594864082845697"), int("758855036025675418327914807352937072\</span>
<span class=sd>9071901715047420004889892225542594864082845697"), 7.588550360256754e+81, \</span>
<span class=sd>int("7588550360256754183279148073529370729071901715047420004889892225\</span>
<span class=sd>542594864082845696"), int("75885503602567541832791480735293707290719017150474\</span>
<span class=sd>20004889892225542594864082845696"), 7.588550360256754e+81, \</span>
<span class=sd>7.588550360256754e+81, int("75885503602567541832791480735293707290719\</span>
<span class=sd>01715047420004889892225542594864082845696"), 7.588550360256754e+81, \</span>
<span class=sd>7.588550360256754e+81, 7.588550360256754e+81)</span>
<span class=sd>        >>> s = SampleStatistics.from_samples(dd)</span>
<span class=sd>        >>> s.stddev</span>
<span class=sd>        0.4354941703556927</span>
<span class=sd>        >>> stat_stddev(dd)</span>
<span class=sd>        0.4354941703556927</span>
<span class=sd>        >>> ddx = tuple(map(_to_frac, dd))</span>
<span class=sd>        >>> ds = sum(ddx)</span>
<span class=sd>        >>> dss = sum(ddy * ddy for ddy in ddx)</span>
<span class=sd>        >>> _limited_root((dss - (ds * ds / len(dd))) / (len(dd) - 1), 2)</span>
<span class=sd>        93206175962530968626911348905791729797971161757128018983942059951</span>
<span class=sd>        >>> ddx = tuple(map(Fraction, dd))</span>
<span class=sd>        >>> ds = sum(ddx)</span>
<span class=sd>        >>> dss = sum(ddy * ddy for ddy in ddx)</span>
<span class=sd>        >>> _limited_root((dss - (ds * ds / len(dd))) / (len(dd) - 1), 2)</span>
<span class=sd>        0.4354941703556927</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_samples(1)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(te)</span>
<span class=sd>        source should be an instance of typing.Iterable but is int, namely 1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     SampleStatistics.from_samples([])</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        Data source cannot be empty.</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=n>Iterable</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=s2>"source"</span><span class=p>,</span> <span class=n>Iterable</span><span class=p>)</span>

        <span class=c1># The median function of statistics would do this anyway, so we may as</span>
        <span class=c1># well do it now.</span>
        <span class=n>data</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>try_int</span><span class=p>,</span> <span class=p>(</span>
            <span class=n>xs</span> <span class=k>for</span> <span class=n>xs</span> <span class=ow>in</span> <span class=n>source</span> <span class=k>if</span> <span class=n>xs</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)))</span>
        <span class=n>n</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>n</span> <span class=o><=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"Data source cannot be empty."</span><span class=p>)</span>

        <span class=n>minimum</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># because data is now sorted</span>
        <span class=n>maximum</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># because data is now sorted</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>minimum</span> <span class=o>>=</span> <span class=n>maximum</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>n</span> <span class=o><=</span> <span class=mi>1</span><span class=p>):</span>  <span class=c1># all data is the same</span>
            <span class=k>return</span> <span class=n>SampleStatistics</span><span class=o>.</span><span class=n>from_single_value</span><span class=p>(</span><span class=n>minimum</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>

        <span class=c1># Compute the median.</span>
        <span class=n>middle</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>n</span> <span class=o>>></span> <span class=mi>1</span>
        <span class=n>median</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>middle</span><span class=p>]</span> <span class=k>if</span> <span class=p>(</span><span class=n>n</span> <span class=o>&</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=k>else</span> <span class=p>(</span>
            <span class=n>_mean_of_two</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>middle</span> <span class=o>-</span> <span class=mi>1</span><span class=p>],</span> <span class=n>data</span><span class=p>[</span><span class=n>middle</span><span class=p>]))</span>

        <span class=c1># Is it possible, at this stage, that all data are integers?</span>
        <span class=n>can_int</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>minimum</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>maximum</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>

        <span class=c1># If we have only two numbers, we also already have the mean.</span>
        <span class=c1># Otherwise, if we have only integer data so far and we know that</span>
        <span class=c1># regardless how we dice it, the sum of the data will never exceed</span>
        <span class=c1># the range in which floats can accurately represent integers, then</span>
        <span class=c1># we also know that we can compute the arithmetic mean exactly.</span>
        <span class=n>mean_arith</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>median</span> <span class=k>if</span> <span class=n>n</span> <span class=o><=</span> <span class=mi>2</span> <span class=k>else</span> <span class=p>(</span>
            <span class=n>try_int</span><span class=p>(</span><span class=n>stat_mean</span><span class=p>(</span><span class=n>data</span><span class=p>))</span> <span class=k>if</span> <span class=n>can_int</span> <span class=ow>and</span> <span class=p>(</span>
                <span class=p>(</span><span class=n>n</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=nb>max</span><span class=p>(</span><span class=n>maximum</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-</span> <span class=nb>min</span><span class=p>(</span><span class=n>minimum</span><span class=p>,</span> <span class=mi>0</span><span class=p>)))</span>
                <span class=o><</span> <span class=n>_DBL_INT_LIMIT_P_I</span><span class=p>)</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span>
        <span class=n>mean_arith_frac</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>mean_geom</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># don't know the geometric mean</span>
        <span class=c1># Go over the data once and see if we can treat it as all-integer.</span>
        <span class=c1># If yes, then we can compute some statistics very precisely.</span>
        <span class=c1># are all values integers?</span>
        <span class=n>int_sum</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># the integer sum (for mean, stddev)</span>
        <span class=n>int_sum_sqr</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># the sum of squares (for stddev)</span>
        <span class=n>int_sum_sqr_2</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># the sum of squares (for stddev)</span>
        <span class=n>int_prod</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span>  <span class=c1># the integer product (for geom_mean)</span>
        <span class=n>frac_sum</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>=</span> <span class=n>_FRAC_0</span>
        <span class=n>frac_sum_sqr</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>=</span> <span class=n>frac_sum</span>
        <span class=n>frac_prod</span><span class=p>:</span> <span class=n>Fraction</span> <span class=o>=</span> <span class=n>_FRAC_1</span>

        <span class=c1># The following is *only* used if we have *only* integer data.</span>
        <span class=c1># stddev((a, b, ...)) = stddev((a-x, b-x, ...))</span>
        <span class=c1># If we can shift the whole data such that its center is around 0,</span>
        <span class=c1># then the difference that we have to add up become smaller, and thus</span>
        <span class=c1># the floating point arithmetic that we may need to use becomes more</span>
        <span class=c1># accurate. If we know the mean, then shifting the data by the mean</span>
        <span class=c1># will lead to the smallest sum of deviations. If we know only the</span>
        <span class=c1># median, then this is better than nothing.</span>
        <span class=n>shift</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>median</span><span class=p>)</span> <span class=k>if</span> <span class=n>mean_arith</span> <span class=ow>is</span> <span class=kc>None</span> \
            <span class=k>else</span> <span class=p>(</span><span class=n>mean_arith</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>mean_arith</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>
                  <span class=k>else</span> <span class=nb>round</span><span class=p>(</span><span class=n>mean_arith</span><span class=p>))</span>

        <span class=k>for</span> <span class=n>ii</span><span class=p>,</span> <span class=n>ee</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>  <span class=c1># iterate over all data</span>
            <span class=k>if</span> <span class=n>can_int</span> <span class=ow>and</span> <span class=p>(</span><span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>ee</span><span class=p>,</span> <span class=nb>int</span><span class=p>)):</span>
                <span class=n>frac_sum</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>int_sum</span> <span class=o>+</span> <span class=n>ii</span> <span class=o>*</span> <span class=n>shift</span><span class=p>)</span>
                <span class=n>frac_sum_sqr</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>int_sum_sqr_2</span><span class=p>)</span>
                <span class=n>frac_prod</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>int_prod</span><span class=p>)</span>
                <span class=n>can_int</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=k>if</span> <span class=n>can_int</span><span class=p>:</span>  <span class=c1># == ee must be int</span>
                <span class=n>int_sum_sqr_2</span> <span class=o>+=</span> <span class=n>ee</span> <span class=o>*</span> <span class=n>ee</span>  <span class=c1># type: ignore</span>
                <span class=n>int_prod</span> <span class=o>*=</span> <span class=n>ee</span>  <span class=c1># type: ignore</span>
                <span class=n>e</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>ee</span> <span class=o>-</span> <span class=n>shift</span>  <span class=c1># type: ignore</span>
                <span class=n>int_sum</span> <span class=o>+=</span> <span class=n>e</span>  <span class=c1># so we can sum exactly</span>
                <span class=n>int_sum_sqr</span> <span class=o>+=</span> <span class=n>e</span> <span class=o>*</span> <span class=n>e</span>  <span class=c1># and compute the sum of squares</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>eef</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>ee</span><span class=p>)</span>
                <span class=n>frac_sum</span> <span class=o>+=</span> <span class=n>eef</span>
                <span class=n>frac_sum_sqr</span> <span class=o>+=</span> <span class=n>eef</span> <span class=o>*</span> <span class=n>eef</span>
                <span class=n>frac_prod</span> <span class=o>*=</span> <span class=n>eef</span>

        <span class=k>if</span> <span class=n>n</span> <span class=o>></span> <span class=mi>2</span><span class=p>:</span>  <span class=c1># mean_arith is None or an approximation</span>
            <span class=n>mean_arith_frac</span> <span class=o>=</span> <span class=p>(</span><span class=n>Fraction</span><span class=p>(</span><span class=n>int_sum</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>+</span> <span class=n>shift</span><span class=p>)</span> \
                <span class=k>if</span> <span class=n>can_int</span> <span class=k>else</span> <span class=p>(</span><span class=n>frac_sum</span> <span class=o>/</span> <span class=n>n</span><span class=p>)</span>
            <span class=n>mean_arith</span> <span class=o>=</span> <span class=n>_from_frac</span><span class=p>(</span><span class=n>mean_arith_frac</span><span class=p>)</span>
        <span class=n>stddev</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=n>_limited_root</span><span class=p>(((</span><span class=n>int_sum_sqr</span> <span class=o>-</span> <span class=n>Fraction</span><span class=p>(</span>
            <span class=n>int_sum</span> <span class=o>*</span> <span class=n>int_sum</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span> <span class=k>if</span> <span class=n>can_int</span> <span class=k>else</span> <span class=p>(</span><span class=n>frac_sum_sqr</span> <span class=o>-</span> <span class=p>(</span>
                <span class=n>frac_sum</span> <span class=o>*</span> <span class=n>frac_sum</span> <span class=o>/</span> <span class=n>n</span><span class=p>)))</span> <span class=o>/</span> <span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>2</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>minimum</span> <span class=o>></span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># geometric mean only defined for all-positive</span>
            <span class=k>if</span> <span class=n>can_int</span><span class=p>:</span>
                <span class=n>frac_prod</span> <span class=o>=</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>int_prod</span><span class=p>)</span>
            <span class=c1># # mean_geom always <= mean_arith</span>
            <span class=n>mean_geom</span> <span class=o>=</span> <span class=n>_limited_root</span><span class=p>(</span>
                <span class=n>frac_prod</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>_to_frac</span><span class=p>(</span><span class=n>minimum</span><span class=p>),</span> <span class=nb>min</span><span class=p>(</span>
                    <span class=n>_to_frac</span><span class=p>(</span><span class=n>maximum</span><span class=p>),</span> <span class=p>(</span><span class=n>Fraction</span><span class=p>(</span><span class=n>mean_arith</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span>
                        <span class=n>mean_arith</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=k>else</span> <span class=n>Fraction</span><span class=p>(</span><span class=n>nextafter</span><span class=p>(</span>
                            <span class=n>mean_arith</span><span class=p>,</span> <span class=n>inf</span><span class=p>)))</span> <span class=k>if</span> <span class=p>(</span><span class=n>mean_arith_frac</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span>
                    <span class=k>else</span> <span class=n>mean_arith_frac</span><span class=p>))</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>mean_geom</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>minimum</span> <span class=o>></span> <span class=mi>0</span><span class=p>):</span>
            <span class=n>mean_geom</span> <span class=o>=</span> <span class=n>stat_geomean</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>mean_geom</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=c1># Deal with errors that may have arisen due to</span>
            <span class=c1># numerical imprecision.</span>
            <span class=k>if</span> <span class=n>mean_geom</span> <span class=o><</span> <span class=n>minimum</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>_almost_le</span><span class=p>(</span><span class=n>minimum</span><span class=p>,</span> <span class=n>mean_geom</span><span class=p>):</span>
                    <span class=n>mean_geom</span> <span class=o>=</span> <span class=n>minimum</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>"mean_geom=</span><span class=si>{</span><span class=n>mean_geom</span><span class=si>}</span><span class=s2> but min=</span><span class=si>{</span><span class=n>minimum</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>mean_arith</span> <span class=o><</span> <span class=n>mean_geom</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>_almost_le</span><span class=p>(</span><span class=n>mean_geom</span><span class=p>,</span> <span class=n>mean_arith</span><span class=p>):</span>
                    <span class=n>mean_geom</span> <span class=o>=</span> <span class=n>mean_arith</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>"mean_geom=</span><span class=si>{</span><span class=n>mean_geom</span><span class=si>}</span><span class=s2> but mean_arith=</span><span class=si>{</span><span class=n>mean_arith</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>SampleStatistics</span><span class=p>(</span><span class=n>minimum</span><span class=o>=</span><span class=n>minimum</span><span class=p>,</span> <span class=n>median</span><span class=o>=</span><span class=n>median</span><span class=p>,</span>
                                <span class=n>mean_arith</span><span class=o>=</span><span class=n>mean_arith</span><span class=p>,</span> <span class=n>mean_geom</span><span class=o>=</span><span class=n>mean_geom</span><span class=p>,</span>
                                <span class=n>maximum</span><span class=o>=</span><span class=n>maximum</span><span class=p>,</span> <span class=n>stddev</span><span class=o>=</span><span class=n>stddev</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=n>n</span><span class=p>)</span></div>
</div>



<div class=viewcode-block id=CsvReader>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.CsvReader>[docs]</a>
<span class=k>class</span><span class=w> </span><span class=nc>CsvReader</span><span class=p>(</span><span class=n>CsvReaderBase</span><span class=p>[</span><span class=n>SampleStatistics</span><span class=p>]):</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    A csv parser for sample statistics.</span>

<span class=sd>    >>> from pycommons.io.csv import csv_read</span>
<span class=sd>    >>> csv = ["n;min;mean;med;geom;max;sd",</span>
<span class=sd>    ...        "3;2;3;4;3;10;5", "6;2;;;;;0", "1;;;2;;;", "3;;;;;0;",</span>
<span class=sd>    ...        "4;5;12;32;11;33;7"]</span>
<span class=sd>    >>> for p in csv_read(csv, CsvReader, CsvReader.parse_row):</span>
<span class=sd>    ...     print(p)</span>
<span class=sd>    3;2;4;3;3;10;5</span>
<span class=sd>    6;2;2;2;2;2;0</span>
<span class=sd>    1;2;2;2;2;2;None</span>
<span class=sd>    3;0;0;0;None;0;0</span>
<span class=sd>    4;5;32;12;11;33;7</span>

<span class=sd>    >>> csv = ["value", "1", "3", "0", "-5", "7"]</span>
<span class=sd>    >>> for p in csv_read(csv, CsvReader, CsvReader.parse_row):</span>
<span class=sd>    ...     print(p)</span>
<span class=sd>    1;1;1;1;1;1;None</span>
<span class=sd>    1;3;3;3;3;3;None</span>
<span class=sd>    1;0;0;0;None;0;None</span>
<span class=sd>    1;-5;-5;-5;None;-5;None</span>
<span class=sd>    1;7;7;7;7;7;None</span>

<span class=sd>    >>> csv = ["n;m;sd", "1;3;", "3;5;0"]</span>
<span class=sd>    >>> for p in csv_read(csv, CsvReader, CsvReader.parse_row):</span>
<span class=sd>    ...     print(p)</span>
<span class=sd>    1;3;3;3;3;3;None</span>
<span class=sd>    3;5;5;5;5;5;0</span>

<span class=sd>    >>> csv = ["n;m", "1;3", "3;5"]</span>
<span class=sd>    >>> for p in csv_read(csv, CsvReader, CsvReader.parse_row):</span>
<span class=sd>    ...     print(p)</span>
<span class=sd>    1;3;3;3;3;3;None</span>
<span class=sd>    3;5;5;5;5;5;0</span>
<span class=sd>    """</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>columns</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>])</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Create a CSV parser for :class:`SampleStatistics`.</span>

<span class=sd>        :param columns: the columns</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvReader(None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(te)</span>
<span class=sd>        columns should be an instance of dict but is None.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvReader(1)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(te)</span>
<span class=sd>        columns should be an instance of dict but is int, namely 1.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvReader(dict())</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        No useful keys remain in {}.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvReader({"a": 1, "b": 2})</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        No useful keys remain in {'a': 1, 'b': 2}.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvReader({KEY_N: 1, "b": 2, "c": 3})</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        No useful keys remain in {'b': 2, 'c': 3}.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvReader({KEY_MINIMUM: 1, "b": 2, "c": 3})</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(ve)</span>
<span class=sd>        Found strange keys in {'b': 2, 'c': 3}.</span>
<span class=sd>        """</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>columns</span><span class=p>)</span>

        <span class=c1>#: the index of the number of elements</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>idx_n</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=n>csv_column_or_none</span><span class=p>(</span>
            <span class=n>columns</span><span class=p>,</span> <span class=n>KEY_N</span><span class=p>)</span>

        <span class=n>has</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>has_idx</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>

        <span class=c1>#: the index of the minimum</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_column_or_none</span><span class=p>(</span>
            <span class=n>columns</span><span class=p>,</span> <span class=n>KEY_MINIMUM</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>has</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=n>has_idx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span>

        <span class=c1>#: the index for the arithmetic mean</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_column_or_none</span><span class=p>(</span>
            <span class=n>columns</span><span class=p>,</span> <span class=n>KEY_MEAN_ARITH</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>has</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=n>has_idx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span>

        <span class=c1>#: the index for the median</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_column_or_none</span><span class=p>(</span>
            <span class=n>columns</span><span class=p>,</span> <span class=n>KEY_MEDIAN</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>has</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=n>has_idx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span>

        <span class=c1>#: the index for the geometric mean</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_column_or_none</span><span class=p>(</span>
            <span class=n>columns</span><span class=p>,</span> <span class=n>KEY_MEAN_GEOM</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>has</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=n>has_idx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span>

        <span class=c1>#: the index for the maximum</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_column_or_none</span><span class=p>(</span>
            <span class=n>columns</span><span class=p>,</span> <span class=n>KEY_MAXIMUM</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>has</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=n>has_idx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span>

        <span class=c1>#: the index for the standard deviation</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__idx_sd</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=n>csv_column_or_none</span><span class=p>(</span>
            <span class=n>columns</span><span class=p>,</span> <span class=n>KEY_STDDEV</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>has</span> <span class=o><=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>if</span> <span class=nb>dict</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>columns</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span> <span class=o>=</span> <span class=n>has_idx</span> <span class=o>=</span> <span class=n>csv_column</span><span class=p>(</span>
                    <span class=n>columns</span><span class=p>,</span> <span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=n>columns</span><span class=o>.</span><span class=n>keys</span><span class=p>())),</span> <span class=kc>True</span><span class=p>)</span>
                <span class=n>has</span> <span class=o>=</span> <span class=mi>1</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"No useful keys remain in </span><span class=si>{</span><span class=n>columns</span><span class=si>!r}</span><span class=s2>."</span><span class=p>)</span>
        <span class=k>if</span> <span class=nb>dict</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>columns</span><span class=p>)</span> <span class=o>></span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Found strange keys in </span><span class=si>{</span><span class=n>columns</span><span class=si>!r}</span><span class=s2>."</span><span class=p>)</span>

        <span class=c1>#: is this a parser for single number statistics?</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__is_single</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_sd</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>has</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__is_single</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span> \
                <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span> <span class=o>=</span> <span class=n>has_idx</span>

<div class=viewcode-block id=CsvReader.parse_row>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.CsvReader.parse_row>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>parse_row</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-></span> <span class=n>SampleStatistics</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Parse a row of data.</span>

<span class=sd>        :param data: the data row</span>
<span class=sd>        :returns: the sample statistics</span>

<span class=sd>        >>> cc = CsvReader({KEY_MINIMUM: 0, KEY_MEAN_ARITH: 1, KEY_MAXIMUM: 2,</span>
<span class=sd>        ...                 KEY_STDDEV: 3, KEY_MEDIAN: 4, KEY_MEAN_GEOM: 5,</span>
<span class=sd>        ...                 KEY_N: 6})</span>
<span class=sd>        >>> try:</span>
<span class=sd>        ...     cc.parse_row([None, None, None, None, None, None, "5"])</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     print(str(ve)[:20])</span>
<span class=sd>        No value defined for</span>
<span class=sd>        """</span>
        <span class=n>n</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>idx_n</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=nb>int</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>idx_n</span><span class=p>])</span>
        <span class=n>mi</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_val_or_none</span><span class=p>(</span>
            <span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span><span class=p>,</span> <span class=n>str_to_num</span><span class=p>)</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__is_single</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>SampleStatistics</span><span class=p>(</span>
                <span class=n>n</span><span class=o>=</span><span class=n>n</span><span class=p>,</span> <span class=n>minimum</span><span class=o>=</span><span class=n>mi</span><span class=p>,</span> <span class=n>median</span><span class=o>=</span><span class=n>mi</span><span class=p>,</span> <span class=n>mean_arith</span><span class=o>=</span><span class=n>mi</span><span class=p>,</span>
                <span class=n>mean_geom</span><span class=o>=</span><span class=n>mi</span> <span class=k>if</span> <span class=p>(</span><span class=n>mi</span> <span class=o>></span> <span class=mi>0</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span>
                <span class=k>else</span> <span class=kc>None</span><span class=p>,</span> <span class=n>maximum</span><span class=o>=</span><span class=n>mi</span><span class=p>,</span> <span class=n>stddev</span><span class=o>=</span><span class=kc>None</span> <span class=k>if</span> <span class=n>n</span> <span class=o><=</span> <span class=mi>1</span> <span class=k>else</span> <span class=mi>0</span><span class=p>)</span>

        <span class=n>ar</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_val_or_none</span><span class=p>(</span>
            <span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span><span class=p>,</span> <span class=n>str_to_num</span><span class=p>)</span>
        <span class=n>me</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_val_or_none</span><span class=p>(</span>
            <span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span><span class=p>,</span> <span class=n>str_to_num</span><span class=p>)</span>
        <span class=n>ge</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_val_or_none</span><span class=p>(</span>
            <span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span><span class=p>,</span> <span class=n>str_to_num</span><span class=p>)</span>
        <span class=n>ma</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_val_or_none</span><span class=p>(</span>
            <span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span><span class=p>,</span> <span class=n>str_to_num</span><span class=p>)</span>
        <span class=n>sd</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=n>csv_val_or_none</span><span class=p>(</span>
            <span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__idx_sd</span><span class=p>,</span> <span class=n>str_to_num</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>mi</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>ar</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>mi</span> <span class=o>=</span> <span class=n>ar</span>
            <span class=k>elif</span> <span class=n>me</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>mi</span> <span class=o>=</span> <span class=n>me</span>
            <span class=k>elif</span> <span class=n>ge</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>mi</span> <span class=o>=</span> <span class=n>ge</span>
            <span class=k>elif</span> <span class=n>ma</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>mi</span> <span class=o>=</span> <span class=n>ma</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>"No value defined for min@</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span><span class=si>}</span><span class=s2>=</span><span class=si>{</span><span class=n>mi</span><span class=si>}</span><span class=s2>, mean@"</span>
                    <span class=sa>f</span><span class=s2>"</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span><span class=si>}</span><span class=s2>=</span><span class=si>{</span><span class=n>ar</span><span class=si>}</span><span class=s2>, med@</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span><span class=si>}</span><span class=s2>="</span>
                    <span class=sa>f</span><span class=s2>"</span><span class=si>{</span><span class=n>me</span><span class=si>}</span><span class=s2>, gmean@</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span><span class=si>}</span><span class=s2>=</span><span class=si>{</span><span class=n>ge</span><span class=si>}</span><span class=s2>, max@"</span>
                    <span class=sa>f</span><span class=s2>"</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span><span class=si>}</span><span class=s2>=</span><span class=si>{</span><span class=n>ma</span><span class=si>}</span><span class=s2> defined in </span><span class=si>{</span><span class=n>data</span><span class=si>!r}</span><span class=s2>."</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>SampleStatistics</span><span class=p>(</span>
            <span class=n>n</span><span class=o>=</span><span class=n>n</span><span class=p>,</span> <span class=n>minimum</span><span class=o>=</span><span class=n>mi</span><span class=p>,</span> <span class=n>mean_arith</span><span class=o>=</span><span class=n>mi</span> <span class=k>if</span> <span class=n>ar</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>ar</span><span class=p>,</span>
            <span class=n>median</span><span class=o>=</span><span class=n>mi</span> <span class=k>if</span> <span class=n>me</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>me</span><span class=p>,</span> <span class=n>mean_geom</span><span class=o>=</span><span class=p>(</span>
                <span class=n>mi</span> <span class=k>if</span> <span class=n>mi</span> <span class=o>></span> <span class=mi>0</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span> <span class=k>if</span> <span class=p>(</span><span class=n>ge</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span> <span class=k>else</span> <span class=n>ge</span><span class=p>,</span>
            <span class=n>maximum</span><span class=o>=</span><span class=n>mi</span> <span class=k>if</span> <span class=n>ma</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>ma</span><span class=p>,</span>
            <span class=n>stddev</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span> <span class=k>if</span> <span class=p>(</span><span class=n>n</span> <span class=o>></span> <span class=mi>1</span><span class=p>)</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span> <span class=k>if</span> <span class=n>sd</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>sd</span><span class=p>)</span></div>


<div class=viewcode-block id=CsvReader.parse_optional_row>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.CsvReader.parse_optional_row>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>parse_optional_row</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>)</span> \
            <span class=o>-></span> <span class=n>SampleStatistics</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Parse a row of data that may be empty.</span>

<span class=sd>        :param data: the row of data that may be empty</span>
<span class=sd>        :returns: the sample statistic, if the row contains data, else `None`</span>

<span class=sd>        >>> print(CsvReader.parse_optional_row(None, ["1"]))</span>
<span class=sd>        None</span>
<span class=sd>        >>> print(CsvReader.parse_optional_row(CsvReader({"v": 0}), ["1"]))</span>
<span class=sd>        1;1;1;1;1;1;None</span>
<span class=sd>        >>> print(CsvReader.parse_optional_row(CsvReader({"v": 0}), [""]))</span>
<span class=sd>        None</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=p>(</span><span class=bp>self</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>data</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>None</span>  <span class=c1># trick to make this method usable pseudo-static</span>
        <span class=c1># pylint: disable=R0916</span>
        <span class=k>if</span> <span class=p>(((</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span>
                <span class=nb>str</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_min</span><span class=p>])</span> <span class=o>></span> <span class=mi>0</span><span class=p>))</span> <span class=ow>or</span> <span class=p>(</span>
                <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span>
                <span class=nb>str</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_arith</span><span class=p>])</span> <span class=o>></span> <span class=mi>0</span><span class=p>))</span> <span class=ow>or</span> <span class=p>(</span>
                <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span>
                <span class=nb>str</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_median</span><span class=p>])</span> <span class=o>></span> <span class=mi>0</span><span class=p>))</span> <span class=ow>or</span> <span class=p>(</span>
                <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span>
                <span class=nb>str</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_mean_geom</span><span class=p>])</span> <span class=o>></span> <span class=mi>0</span><span class=p>))</span> <span class=ow>or</span> <span class=p>(</span>
                <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span>
                <span class=nb>str</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__idx_max</span><span class=p>])</span> <span class=o>></span> <span class=mi>0</span><span class=p>))):</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse_row</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
        <span class=k>return</span> <span class=kc>None</span></div>
</div>



<div class=viewcode-block id=CsvWriter>
<a class=viewcode-back href=../../../pycommons.math.html#pycommons.math.sample_statistics.CsvWriter>[docs]</a>
<span class=k>class</span><span class=w> </span><span class=nc>CsvWriter</span><span class=p>(</span><span class=n>CsvWriterBase</span><span class=p>[</span><span class=n>SampleStatistics</span><span class=p>]):</span>
<span class=w>    </span><span class=sd>"""A class for CSV writing of :class:`SampleStatistics`."""</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
                 <span class=n>data</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=n>SampleStatistics</span><span class=p>],</span>
                 <span class=n>scope</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
                 <span class=n>n_not_needed</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
                 <span class=n>what_short</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
                 <span class=n>what_long</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Initialize the csv writer.</span>

<span class=sd>        :param data: the data to use</span>
<span class=sd>        :param scope: the prefix to be pre-pended to all columns</span>
<span class=sd>        :param n_not_needed: should we omit the `n` column?</span>
<span class=sd>        :param what_short: the short description of what the statistics is</span>
<span class=sd>            about</span>
<span class=sd>        :param what_long: the long statistics of what the statistics is about</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvWriter([], None, n_not_needed=None)</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(te)</span>
<span class=sd>        n_not_needed should be an instance of bool but is None.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvWriter([])</span>
<span class=sd>        ... except ValueError as ve:</span>
<span class=sd>        ...     s = str(ve)</span>
<span class=sd>        ...     print(s[s.index(' ') + 1:])</span>
<span class=sd>        CsvWriter did not see any data.</span>

<span class=sd>        >>> try:</span>
<span class=sd>        ...     CsvWriter([1])</span>
<span class=sd>        ... except TypeError as te:</span>
<span class=sd>        ...     print(str(te)[:32])</span>
<span class=sd>        data[0] should be an instance of</span>
<span class=sd>        """</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>scope</span><span class=p>,</span> <span class=n>n_not_needed</span><span class=p>,</span> <span class=n>what_short</span><span class=p>,</span> <span class=n>what_long</span><span class=p>,</span>
                         <span class=n>SampleStatistics</span><span class=p>)</span></div>



<span class=k>class</span><span class=w> </span><span class=nc>_SampleStats</span><span class=p>(</span><span class=n>StreamStatisticsAggregate</span><span class=p>[</span><span class=n>SampleStatistics</span><span class=p>]):</span>
<span class=w>    </span><span class=sd>"""The internal sample statistics aggregate."""</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""Initialize the stream statistics."""</span>
        <span class=c1>#: the internal data list</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__lst</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>reset</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""Reset the sample statistics."""</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__lst</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Add a value to the statistics.</span>

<span class=sd>        :param value: the value</span>
<span class=sd>        """</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__lst</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>try_int</span><span class=p>(</span><span class=n>value</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=nb>float</span> <span class=o>|</span> <span class=kc>None</span><span class=p>])</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Add a stream of data.</span>

<span class=sd>        :param data: the data stream</span>
<span class=sd>        """</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__lst</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>xs</span> <span class=k>for</span> <span class=n>xs</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>xs</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>result</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=n>SampleStatistics</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Get the arithmetic mean.</span>

<span class=sd>        :return: the arithmetic mean or `None` if no value was added yet</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=n>SampleStatistics</span><span class=o>.</span><span class=n>from_samples</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__lst</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>result_or_none</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=n>SampleStatistics</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Get the result if any data was collected, otherwise `None`.</span>

<span class=sd>        :return: The return value of :meth:`result` if any data was collected,</span>
<span class=sd>            otherwise `None`</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>result</span><span class=p>()</span> <span class=k>if</span> <span class=nb>list</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__lst</span><span class=p>)</span> <span class=o>></span> <span class=mi>0</span> <span class=k>else</span> <span class=kc>None</span>
</pre></div><div class=clearer></div></div></div></div><div aria-label=Main class=sphinxsidebar role=navigation><div class=sphinxsidebarwrapper><search id=searchbox role=search style=display:none> <h3 id=searchlabel>Quick search</h3> <div class=searchformwrapper><form action=../../../search.html class=search><input aria-labelledby=searchlabel autocapitalize=off autocomplete=off autocorrect=off name=q spellcheck=false><input type=submit value=Go></form></div> </search><script>document.getElementById(`searchbox`).style.display=`block`;</script></div></div><div class=clearer></div></div><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"href=../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../index.html>pycommons 0.8.89 documentation</a> »<li class="nav-item nav-item-1"><a href=../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>pycommons.math.sample_statistics</a></ul></div><div class=footer role=contentinfo>© Copyright 2023-2026, Thomas Weise.</div>
