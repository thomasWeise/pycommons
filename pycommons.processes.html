<!doctype html><html data-content_root=./ lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0"name=viewport><meta content="width=device-width,initial-scale=1"name=viewport><title>pycommons.processes package — pycommons 0.8.89 documentation</title><link href="/pycommons/_static/pygments.css?v=b86133f3"rel=stylesheet><link href="/pycommons/_static/bizstyle.css?v=5283bb3d"rel=stylesheet><script src="/pycommons/_static/documentation_options.js?v=4db5eb0a"></script><script src="/pycommons/_static/doctools.js?v=fd6eb6e6"></script><script src="/pycommons/_static/sphinx_highlight.js?v=6ffebe34"></script><script src=_static/bizstyle.js></script><link href=https://thomasweise.github.io/pycommons/pycommons.processes.html rel=canonical><link href=genindex.html rel=index title=Index><link href=search.html rel=search title=Search><link title="pycommons.strings package"href=pycommons.strings.html rel=next><link title="pycommons.net package"href=pycommons.net.html rel=prev><meta content="width=device-width,initial-scale=1.0"name=viewport><body><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"accesskey=I href=genindex.html>index</a><li class=right><a title="Python Module Index"href=py-modindex.html>modules</a> |<li class=right><a title="pycommons.strings package"accesskey=N href=pycommons.strings.html>next</a> |<li class=right><a title="pycommons.net package"accesskey=P href=pycommons.net.html>previous</a> |<li class="nav-item nav-item-0"><a href=index.html>pycommons 0.8.89 documentation</a> »<li class="nav-item nav-item-1"><a href=modules.html>pycommons</a> »<li class="nav-item nav-item-2"><a accesskey=U href=pycommons.html>pycommons package</a> »<li class="nav-item nav-item-this"><a href>pycommons.processes package</a></ul></div><div class=document><div class=documentwrapper><div class=bodywrapper><div class=body role=main><section id=module-pycommons.processes><span id=pycommons-processes-package></span><h1>pycommons.processes package<a title="Link to this heading"class=headerlink href=#module-pycommons.processes>¶</a></h1><p>Utilities for dealing with processes.<section id=submodules><h2>Submodules<a title="Link to this heading"class=headerlink href=#submodules>¶</a></h2></section><section id=module-pycommons.processes.caller><span id=pycommons-processes-caller-module></span><h2>pycommons.processes.caller module<a title="Link to this heading"class=headerlink href=#module-pycommons.processes.caller>¶</a></h2><p>Get information about how this process was called.<dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.caller.is_build><span class="sig-prename descclassname"><span class=pre>pycommons.processes.caller.</span></span><span class="sig-name descname"><span class=pre>is_build</span></span><span class=sig-paren>(</span><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/caller.html#is_build><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.caller.is_build>¶</a><dd><p>Check if the program was run inside a build.</p> <p>This function is <cite>True</cite> if the process is running inside a <cite>make</cite> build or if <a class="reference internal"href=#pycommons.processes.caller.is_ci_run title=pycommons.processes.caller.is_ci_run><code class="xref py py-func docutils literal notranslate"><span class=pre>is_ci_run()</span></code></a> is <cite>True</cite> or if the evironment variable <cite>BUILD_SCRIPT</cite> is set.</p> <p>Since we now need to use virtual environments to install <cite>pip</cite> packages, using <cite>make</cite> scripts has become too cumbersome to me. I simply cannot be bothered to figure out how to set up a virtual environment <cite>make</cite> script wide. Instead, I now use a <cite>bash</cite> script (<cite>make.sh</cite>) in my builds. To properly detect this, this script sets the environment variable <cite>BUILD_SCRIPT</cite>. In all my <cite>pycommons</cite>-based projects, I will do this from now on.</p> <p>Basically, if you want to signal that code runs inside a build, you can set an environment variable as <cite>export BUILD_SCRIPT=”${BASH_SOURCE[0]}”</cite> inside your <cite>bash</cite> build script. This will be used as signal by this function that we are running inside a build.</p> <dl class="field-list simple"><dt class=field-odd>Return type<span class=colon>:</span><dd class=field-odd><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#bool><code class="xref py py-class docutils literal notranslate"><span class=pre>bool</span></code></a></span></p><dt class=field-even>Returns<span class=colon>:</span><dd class=field-even><p><cite>True</cite> if this process is executed as part of a build process, <cite>False</cite> otherwise.</p></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=nb>isinstance</span><span class=p>(</span><span class=n>is_build</span><span class=p>(),</span> <span class=nb>bool</span><span class=p>)</span>
<span class=go>True</span>
</pre></div></div></dl><dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.caller.is_ci_run><span class="sig-prename descclassname"><span class=pre>pycommons.processes.caller.</span></span><span class="sig-name descname"><span class=pre>is_ci_run</span></span><span class=sig-paren>(</span><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/caller.html#is_ci_run><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.caller.is_ci_run>¶</a><dd><p>Check if the program runs in a continuous integration environment.</p> <p>Right now, only GitHub actions are recognized. Other CI tools are currently not supported.</p> <dl class="field-list simple"><dt class=field-odd>Return type<span class=colon>:</span><dd class=field-odd><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#bool><code class="xref py py-class docutils literal notranslate"><span class=pre>bool</span></code></a></span></p><dt class=field-even>Returns<span class=colon>:</span><dd class=field-even><p><cite>True</cite> if this process is executed as part of, e.g., a GitHub action, <cite>False</cite> otherwise.</p></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=nb>isinstance</span><span class=p>(</span><span class=n>is_ci_run</span><span class=p>(),</span> <span class=nb>bool</span><span class=p>)</span>
<span class=go>True</span>
</pre></div></div></dl><dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.caller.is_doc_test><span class="sig-prename descclassname"><span class=pre>pycommons.processes.caller.</span></span><span class="sig-name descname"><span class=pre>is_doc_test</span></span><span class=sig-paren>(</span><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/caller.html#is_doc_test><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.caller.is_doc_test>¶</a><dd><p>Check if this process was invoked by a unit doctest.</p> <dl class="field-list simple"><dt class=field-odd>Return type<span class=colon>:</span><dd class=field-odd><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#bool><code class="xref py py-class docutils literal notranslate"><span class=pre>bool</span></code></a></span></p><dt class=field-even>Returns<span class=colon>:</span><dd class=field-even><p><cite>True</cite> if this function was called by a unit doctest, <cite>False</cite> otherwise</p></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>is_doc_test</span><span class=p>()</span>
<span class=go>True</span>
</pre></div></div></dl></section><section id=module-pycommons.processes.fork><span id=pycommons-processes-fork-module></span><h2>pycommons.processes.fork module<a title="Link to this heading"class=headerlink href=#module-pycommons.processes.fork>¶</a></h2><p>Fork a Python interpreter process multiple times.<p>The use case for this tool is when you have a main script in your Python program and want to allow a user to launch it multiple times with the sme parameters. In this case, she would simply provide the argument <cite>–fork NNN</cite>, where <cite>NNN</cite> is either the absolute number of times the program should be launched or a fraction in (0, 1) of the available logical cores to use.<p>You would use the normal <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/argparse.html#argparse.ArgumentParser><code class="xref py py-class docutils literal notranslate"><span class=pre>ArgumentParser</span></code></a> in your main code piece, i.e., do something like <cite>if __name__ == “__main__”:</cite> followed by ` parser: Final[ArgumentParser] = …`.<p>Then, you would invoke <cite>args = fork(parser)</cite>, where <a class="reference internal"href=#pycommons.processes.fork.fork title=pycommons.processes.fork.fork><code class="xref py py-func docutils literal notranslate"><span class=pre>fork()</span></code></a> is the function provided here. This function will return <cite>None</cite> if it has detected the <cite>–fork</cite> argument. In that case, it will have launched the process again the appropriate number of times and waited for its completion already. If it did not detect the <cite>–fork</cite> argument, it will return the <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/argparse.html#argparse.Namespace><code class="xref py py-class docutils literal notranslate"><span class=pre>Namespace</span></code></a> instance with the normal arguments. Actually, it will do exactly this in the launched copies of the process.<p>So from the outside, this looks pretty much like the good old <cite>fork</cite> command on Unix systems. However, it can do a little bit more. For each process copy (except the original process), the <cite>args.fork_id</cite> will hold a unique ID of the forked process.<p>Also, you can provide the command <cite>–fork-log-dir YYY</cite> to the original process. In this case, each of the forked processes will not be launched normally. Instead, its stdout and stderr will be piped into two different files inside the directory <cite>YYY</cite>. This makes working with experiments, like in the <em>moptipy</em> framework (see <<a class="reference external"href=https://thomasweise.github.io/moptipy>https://thomasweise.github.io/moptipy</a>>) easier.<p>The gist is this: Under the hood, this looks as if you can do Unix-style forks of the Python interpreter. Actually, it launches separate interpreter processes with the same arguments (plus the <cite>fork_id</cite> parameter and minus the forking-arguments).<p>Side note: If you do not provide a logging directory and the number of processes to launch would be 1, then no forking takes place. This then just returns the normal arguments as if no forking parameters were provided at all.<dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.fork.fork><span class="sig-prename descclassname"><span class=pre>pycommons.processes.fork.</span></span><span class="sig-name descname"><span class=pre>fork</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>parser</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/fork.html#fork><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.fork.fork>¶</a><dd><p>Launch this Python process multiple times if requested to.</p> <p>If the user provided an argument <cite>–fork NNN</cite>, where <cite>NNN</cite> is either an absolute number of processes to launch or a fraction in (0, 1) of logical CPU cores to use, then this function will invoke the interpreter the corresponding number of times with exactly the same command line arguments except the forking parameters.</p> <p>You can provide an argument <cite>–fork-log-dir DDD</cite>, where <cite>DDD</cite> is a directory. If you do this, then the stdout and stderr of each launched process are piped into files inside this directory.</p> <p>If forking is done, then each forked process gets an additional argument <cite>fork_id</cite> with a unique identifier.</p> <p>If no forking arguments are provided, of if we would fork just 1 process without logging directory, then no forking is done. In this case, this routine just returns the <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/argparse.html#argparse.Namespace><code class="xref py py-class docutils literal notranslate"><span class=pre>Namespace</span></code></a> instance with the command line arguments. If this actually already is a forked process, then, too, the <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/argparse.html#argparse.Namespace><code class="xref py py-class docutils literal notranslate"><span class=pre>Namespace</span></code></a> instance with the arguments (plus the <cite>fork_id</cite>) is returned. If this is the root process from which the forks were started, then <cite>None</cite> is returned. In that case, the function returns after all sub-processes are completed.</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><p><strong>parser</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/argparse.html#argparse.ArgumentParser><code class="xref py py-class docutils literal notranslate"><span class=pre>ArgumentParser</span></code></a></span>) – the root argument parser</p><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/argparse.html#argparse.Namespace><code class="xref py py-class docutils literal notranslate"><span class=pre>Namespace</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a></span></p><dt class=field-odd>Returns<span class=colon>:</span><dd class=field-odd><p><cite>None</cite> if the argument parser contained forking arguments and the same process was forked multiple times, otherwise the <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/argparse.html#argparse.Namespace><code class="xref py py-class docutils literal notranslate"><span class=pre>Namespace</span></code></a> with the arguments.</p></dl></dl><dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.fork.get_cores><span class="sig-prename descclassname"><span class=pre>pycommons.processes.fork.</span></span><span class="sig-name descname"><span class=pre>get_cores</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>use</span></span></em>, <em class=sig-param><span class=n><span class=pre>n_cpu</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>None</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/fork.html#get_cores><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.fork.get_cores>¶</a><dd><p>Compute the number of CPU cores to be used (for forking).</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><ul class=simple><li><p><strong>use</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><code class="xref py py-class docutils literal notranslate"><span class=pre>int</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#float><code class="xref py py-class docutils literal notranslate"><span class=pre>float</span></code></a></span>) – the usage number, either a float between 0 and 1 denoting a fraction of cores to be used, or the absolute number.<li><p><strong>n_cpu</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><code class="xref py py-class docutils literal notranslate"><span class=pre>int</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a></span>, default: <code class="docutils literal notranslate"><span class=pre>None</span></code>) – the number of CPU cores available, or <cite>None</cite> if we should determine it automatically.</ul><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><code class="xref py py-class docutils literal notranslate"><span class=pre>int</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a></span></p><dt class=field-odd>Returns<span class=colon>:</span><dd class=field-odd><p>the number of cores</p></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=go>1</span>
<span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
<span class=go>2</span>
<span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mf>2.3</span><span class=p>)</span>
<span class=go>2</span>
<span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mf>2.6</span><span class=p>)</span>
<span class=go>3</span>
<span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
<span class=go>5</span>
<span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mf>0.3</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
<span class=go>3</span>
<span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
<span class=go>8</span>
<span class=gp>>>> </span><span class=n>get_cores</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=go>1</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=mi>0</span> <span class=o><</span> <span class=n>get_cores</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span> <span class=o><</span> <span class=mi>10000</span>
<span class=go>True</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>get_cores</span><span class=p>(</span><span class=s2>"a"</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>use should be an instance of any in {float, int} but is str, namely 'a'.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>get_cores</span><span class=p>(</span><span class=mf>0.3</span><span class=p>,</span> <span class=s2>"a"</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>n_cpu should be an instance of int but is str, namely 'a'.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>get_cores</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>v</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
<span class=go>Invalid value -1 for number of cores to use.</span>
</pre></div></div></dl></section><section id=module-pycommons.processes.multishell><span id=pycommons-processes-multishell-module></span><h2>pycommons.processes.multishell module<a title="Link to this heading"class=headerlink href=#module-pycommons.processes.multishell>¶</a></h2><p>A tool for running multiple commands in parallel.<div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>pycommons.processes.shell</span><span class=w> </span><span class=kn>import</span> <span class=n>STREAM_CAPTURE</span>
<span class=gp>>>> </span><span class=n>c1</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"123"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>c2</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"abc"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
<span class=go>(('123\n', None), ('abc\n', None))</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=p>),</span> <span class=kc>False</span><span class=p>)</span>
<span class=go>(('123\n', None),)</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>,</span> <span class=n>c2</span><span class=p>,</span> <span class=n>c2</span><span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
<span class=go>(('123\n', None), ('abc\n', None), ('abc\n', None), ('abc\n', None))</span>
</pre></div></div><dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.multishell.multi_execute><span class="sig-prename descclassname"><span class=pre>pycommons.processes.multishell.</span></span><span class="sig-name descname"><span class=pre>multi_execute</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>commands</span></span></em>, <em class=sig-param><span class=n><span class=pre>log</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>True</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/multishell.html#multi_execute><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.multishell.multi_execute>¶</a><dd><p>Execute multiple commands in parallel.</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><ul class=simple><li><p><strong>commands</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Iterable><code class="xref py py-class docutils literal notranslate"><span class=pre>Iterable</span></code></a>[<a class="reference internal"href=#pycommons.processes.shell.Command title=pycommons.processes.shell.Command><code class="xref py py-class docutils literal notranslate"><span class=pre>Command</span></code></a>]</span>) – the iterable of the commands to execute<li><p><strong>log</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#bool><code class="xref py py-class docutils literal notranslate"><span class=pre>bool</span></code></a></span>, default: <code class="docutils literal notranslate"><span class=pre>True</span></code>) – shall the execution state be logged?</ul><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#tuple><code class="xref py py-class docutils literal notranslate"><span class=pre>tuple</span></code></a>[<a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#tuple><code class="xref py py-class docutils literal notranslate"><span class=pre>tuple</span></code></a>[<a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a>, <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a>], <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#Ellipsis><code class="xref py py-data docutils literal notranslate"><span class=pre>...</span></code></a>]</span></p><dt class=field-odd>Returns<span class=colon>:</span><dd class=field-odd><p>the results of the commands</p></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>pycommons.processes.shell</span><span class=w> </span><span class=kn>import</span> <span class=n>STREAM_CAPTURE</span>
<span class=gp>>>> </span><span class=n>c1</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"123"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>c2</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"abc"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((),</span> <span class=kc>False</span><span class=p>)</span>
<span class=go>()</span>
<span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((),</span> <span class=kc>True</span><span class=p>)</span>
<span class=go>()</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=p>),</span> <span class=kc>False</span><span class=p>)</span>
<span class=go>(('123\n', None),)</span>
<span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
<span class=go>(('123\n', None),)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>),</span> <span class=kc>False</span><span class=p>)</span>
<span class=go>(('123\n', None), ('abc\n', None))</span>
<span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
<span class=go>(('123\n', None), ('abc\n', None))</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>,</span> <span class=n>c2</span><span class=p>,</span> <span class=n>c2</span><span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
<span class=go>(('123\n', None), ('abc\n', None), ('abc\n', None), ('abc\n', None))</span>
<span class=gp>>>> </span><span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>,</span> <span class=n>c2</span><span class=p>,</span> <span class=n>c2</span><span class=p>),</span> <span class=kc>False</span><span class=p>)</span>
<span class=go>(('123\n', None), ('abc\n', None), ('abc\n', None), ('abc\n', None))</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>multi_execute</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>commands should be an instance of typing.Iterable but is int, namely 1.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>multi_execute</span><span class=p>((</span><span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>),</span> <span class=mi>3</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>log should be an instance of bool but is int, namely 3.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>multi_execute</span><span class=p>((</span><span class=s2>"x"</span><span class=p>,</span> <span class=p>))</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>te</span><span class=p>)[:</span><span class=mi>20</span><span class=p>])</span>
<span class=go>commands[0] should b</span>
</pre></div></div></dl></section><section id=module-pycommons.processes.python><span id=pycommons-processes-python-module></span><h2>pycommons.processes.python module<a title="Link to this heading"class=headerlink href=#module-pycommons.processes.python>¶</a></h2><p>Some utilities for dealing with python.<div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>PYTHON_INTERPRETER</span><span class=o>.</span><span class=n>is_file</span><span class=p>()</span>
<span class=go>True</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>PYTHON_INTERPRETER_SHORT</span>
<span class=go>'python3'</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=nb>len</span><span class=p>(</span><span class=n>__BASE_PATHS</span><span class=p>)</span> <span class=o>></span> <span class=mi>0</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=nb>all</span><span class=p>((</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>Path</span><span class=p>)</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>__BASE_PATHS</span><span class=p>))</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=nb>all</span><span class=p>((</span><span class=nb>len</span><span class=p>(</span><span class=n>__BASE_PATHS</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>__BASE_PATHS</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span>
<span class=gp>... </span>     <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>__BASE_PATHS</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)))</span>
<span class=go>True</span>
</pre></div></div><dl class="py data"><dt class="sig sig-object py"id=pycommons.processes.python.PYTHON_ENV><span class="sig-prename descclassname"><span class=pre>pycommons.processes.python.</span></span><span class="sig-name descname"><span class=pre>PYTHON_ENV</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Final><span class=pre>Final</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Mapping><span class=pre>Mapping</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><span class=pre>str</span></a><span class=p><span class=pre>,</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><span class=pre>str</span></a><span class=p><span class=pre>]</span></span><span class=p><span class=pre>]</span></span></span><span class=property><span class=w> </span><span class=p><span class=pre>=</span></span><span class=w> </span><span class=pre>mappingproxy({'PATH':</span> <span class=pre>'/tmp/tmp.xHTFIcvcHf/bin:/opt/hostedtoolcache/Python/3.12.12/x64/bin:/opt/hostedtoolcache/Python/3.12.12/x64:/snap/bin:/home/runner/.local/bin:/opt/pipx_bin:/home/runner/.cargo/bin:/home/runner/.config/composer/vendor/bin:/usr/local/.ghcup/bin:/home/runner/.dotnet/tools:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin',</span> <span class=pre>'PYTHONPATH':</span> <span class=pre>'/home/runner/work/pycommons/pycommons',</span> <span class=pre>'PYTHON_INTERPRETER':</span> <span class=pre>'/tmp/tmp.xHTFIcvcHf/bin/python3',</span> <span class=pre>'VIRTUAL_ENV':</span> <span class=pre>'/tmp/tmp.xHTFIcvcHf'})</span></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.python.PYTHON_ENV>¶</a><dd><p>The environment variables related to Python that were set in the current process. It makes sense to pass these on with any <a class="reference internal"href=#pycommons.processes.python.python_command title=pycommons.processes.python.python_command><code class="xref py py-func docutils literal notranslate"><span class=pre>python_command()</span></code></a> invocation or other calls to the Python interpreter. This collection includes information about the Python interpreter, executable, <cite>PATH</cite>, and the virtual environment, if any, as well as any Python-related environment variables passed to this process. The special variable <cite>PYTHON_INTERPRETER</cite> will be passed into this environment. If it already exists in this process’ environment, it will be passed along as-is. If it does not exist in the current environment, it is created and made to point to the Python executable that was used to launch this process.</p></dl><dl class="py data"><dt class="sig sig-object py"id=pycommons.processes.python.PYTHON_INTERPRETER><span class="sig-prename descclassname"><span class=pre>pycommons.processes.python.</span></span><span class="sig-name descname"><span class=pre>PYTHON_INTERPRETER</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Final><span class=pre>Final</span></a><span class=p><span class=pre>[</span></span><a class="reference internal"href=pycommons.io.html#pycommons.io.path.Path title=pycommons.io.path.Path><span class=pre>Path</span></a><span class=p><span class=pre>]</span></span></span><span class=property><span class=w> </span><span class=p><span class=pre>=</span></span><span class=w> </span><span class=pre>'/tmp/tmp.xHTFIcvcHf/bin/python3'</span></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.python.PYTHON_INTERPRETER>¶</a><dd><p>the Python interpreter used to launch this program</p></dl><dl class="py data"><dt class="sig sig-object py"id=pycommons.processes.python.PYTHON_INTERPRETER_SHORT><span class="sig-prename descclassname"><span class=pre>pycommons.processes.python.</span></span><span class="sig-name descname"><span class=pre>PYTHON_INTERPRETER_SHORT</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Final><span class=pre>Final</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><span class=pre>str</span></a><span class=p><span class=pre>]</span></span></span><span class=property><span class=w> </span><span class=p><span class=pre>=</span></span><span class=w> </span><span class=pre>'python3'</span></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.python.PYTHON_INTERPRETER_SHORT>¶</a><dd><p>The python interpreter in short form.</p></dl><dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.python.python_command><span class="sig-prename descclassname"><span class=pre>pycommons.processes.python.</span></span><span class="sig-name descname"><span class=pre>python_command</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>file</span></span></em>, <em class=sig-param><span class=n><span class=pre>use_short_interpreter</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>True</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/python.html#python_command><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.python.python_command>¶</a><dd><p>Get a python command that could be used to interpret the given file.</p> <p>This function tries to detect whether <cite>file</cite> identifies a Python module of an installed package, in which case it will issue a <cite>-m</cite> flag in the resulting command, or whether it is some other script, in which it will just return a normal interpreter invocation.</p> <p>Notice that you should forward <a class="reference internal"href=#pycommons.processes.python.PYTHON_ENV title=pycommons.processes.python.PYTHON_ENV><code class="xref py py-const docutils literal notranslate"><span class=pre>PYTHON_ENV</span></code></a> as environment to the new Python process if it uses any packages. If we are currently running in a virtual environment, we want to tell this command about that.</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><ul class=simple><li><p><strong>file</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a></span>) – the python script<li><p><strong>use_short_interpreter</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#bool><code class="xref py py-class docutils literal notranslate"><span class=pre>bool</span></code></a></span>, default: <code class="docutils literal notranslate"><span class=pre>True</span></code>) – use the short interpreter path, for reabability and maybe portablity, or the full path?</ul><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#list><code class="xref py py-class docutils literal notranslate"><span class=pre>list</span></code></a>[<a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a>]</span></p><dt class=field-odd>Returns<span class=colon>:</span><dd class=field-odd><p>a list that can be passed to the shell to run that program, see, e.g., <a class="reference internal"href=#pycommons.processes.shell.Command title=pycommons.processes.shell.Command><code class="xref py py-class docutils literal notranslate"><span class=pre>pycommons.processes.shell.Command</span></code></a>.</p></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=vm>__file__</span><span class=p>)</span>
<span class=go>['python3', '-m', 'os']</span>
<span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span>
<span class=go>['python3', '-m', 'pycommons.processes.python']</span>
<span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>tempfile</span><span class=w> </span><span class=kn>import</span> <span class=n>mkstemp</span>
<span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>os</span><span class=w> </span><span class=kn>import</span> <span class=n>remove</span> <span class=k>as</span> <span class=n>osremovex</span>
<span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>os</span><span class=w> </span><span class=kn>import</span> <span class=n>close</span> <span class=k>as</span> <span class=n>osclosex</span>
<span class=gp>>>> </span><span class=n>h</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>mkstemp</span><span class=p>(</span><span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>osclosex</span><span class=p>(</span><span class=n>h</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=p>[</span><span class=n>PYTHON_INTERPRETER_SHORT</span><span class=p>,</span> <span class=n>p</span><span class=p>]</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span> <span class=o>==</span> <span class=p>[</span><span class=n>PYTHON_INTERPRETER</span><span class=p>,</span> <span class=n>p</span><span class=p>]</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>osremovex</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>h</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>mkstemp</span><span class=p>(</span><span class=nb>dir</span><span class=o>=</span><span class=n>file_path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span><span class=o>.</span><span class=n>up</span><span class=p>(),</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>osclosex</span><span class=p>(</span><span class=n>h</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=p>[</span><span class=n>PYTHON_INTERPRETER_SHORT</span><span class=p>,</span> <span class=n>p</span><span class=p>]</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span> <span class=o>==</span> <span class=p>[</span><span class=n>PYTHON_INTERPRETER</span><span class=p>,</span> <span class=n>p</span><span class=p>]</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>osremovex</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>the_pack</span> <span class=o>=</span> <span class=n>file_path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span><span class=o>.</span><span class=n>up</span><span class=p>()</span>
<span class=gp>>>> </span><span class=n>h</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>mkstemp</span><span class=p>(</span><span class=nb>dir</span><span class=o>=</span><span class=n>the_pack</span><span class=p>,</span>
<span class=gp>... </span>               <span class=n>suffix</span><span class=o>=</span><span class=s2>".py"</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>osclosex</span><span class=p>(</span><span class=n>h</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>the_str</span> <span class=o>=</span> <span class=n>p</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>the_pack</span><span class=o>.</span><span class=n>up</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span> <span class=o>+</span> <span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>sep</span><span class=p>,</span> <span class=s1>'.'</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=p>[</span><span class=n>PYTHON_INTERPRETER_SHORT</span><span class=p>,</span> <span class=s2>"-m"</span><span class=p>,</span> <span class=n>the_str</span><span class=p>]</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>python_command</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span> <span class=o>==</span> <span class=p>[</span><span class=n>PYTHON_INTERPRETER</span><span class=p>,</span> <span class=s2>"-m"</span><span class=p>,</span> <span class=n>the_str</span><span class=p>]</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>osremovex</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</pre></div></div></dl></section><section id=module-pycommons.processes.shell><span id=pycommons-processes-shell-module></span><h2>pycommons.processes.shell module<a title="Link to this heading"class=headerlink href=#module-pycommons.processes.shell>¶</a></h2><p>The tool for invoking shell commands.<div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"123"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
<span class=go>('123\n', None)</span>
</pre></div></div><dl class="py class"><dt class="sig sig-object py"id=pycommons.processes.shell.Command><span class=property><span class=k><span class=pre>class</span></span><span class=w> </span></span><span class="sig-prename descclassname"><span class=pre>pycommons.processes.shell.</span></span><span class="sig-name descname"><span class=pre>Command</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>command</span></span></em>, <em class=sig-param><span class=n><span class=pre>working_dir</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>None</span></span></em>, <em class=sig-param><span class=n><span class=pre>timeout</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>3600</span></span></em>, <em class=sig-param><span class=n><span class=pre>stdin</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>None</span></span></em>, <em class=sig-param><span class=n><span class=pre>stdout</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>0</span></span></em>, <em class=sig-param><span class=n><span class=pre>stderr</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>0</span></span></em>, <em class=sig-param><span class=n><span class=pre>env</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>None</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/shell.html#Command><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command>¶</a><dd><p>Bases: <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#object><code class="xref py py-class docutils literal notranslate"><span class=pre>object</span></code></a></p> <p>A class that represents a command that can be executed.</p> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>c</span> <span class=o>=</span> <span class=n>Command</span><span class=p>(</span><span class=s2>"test"</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>c</span><span class=o>.</span><span class=n>command</span>
<span class=go>('test',)</span>
<span class=gp>>>> </span><span class=n>c</span><span class=o>.</span><span class=n>working_dir</span><span class=o>.</span><span class=n>is_dir</span><span class=p>()</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>c</span><span class=o>.</span><span class=n>timeout</span>
<span class=go>3600</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>d</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"test"</span><span class=p>,</span> <span class=s2>"b"</span><span class=p>))</span>
<span class=gp>>>> </span><span class=n>d</span><span class=o>.</span><span class=n>command</span>
<span class=go>('test', 'b')</span>
<span class=gp>>>> </span><span class=n>d</span><span class=o>.</span><span class=n>working_dir</span> <span class=o>==</span> <span class=n>c</span><span class=o>.</span><span class=n>working_dir</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>d</span><span class=o>.</span><span class=n>timeout</span> <span class=o>==</span> <span class=n>c</span><span class=o>.</span><span class=n>timeout</span>
<span class=go>True</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>e</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>""</span><span class=p>,</span> <span class=s2>"test"</span><span class=p>,</span> <span class=s2>" b"</span><span class=p>,</span> <span class=s2>" "</span><span class=p>))</span>
<span class=gp>>>> </span><span class=n>e</span><span class=o>.</span><span class=n>command</span> <span class=o>==</span> <span class=n>d</span><span class=o>.</span><span class=n>command</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>e</span><span class=o>.</span><span class=n>working_dir</span> <span class=o>==</span> <span class=n>c</span><span class=o>.</span><span class=n>working_dir</span>
<span class=go>True</span>
<span class=gp>>>> </span><span class=n>e</span><span class=o>.</span><span class=n>timeout</span> <span class=o>==</span> <span class=n>c</span><span class=o>.</span><span class=n>timeout</span>
<span class=go>True</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>te</span><span class=p>)[:</span><span class=mi>50</span><span class=p>])</span>
<span class=go>command should be an instance of any in {str, typi</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>([</span><span class=mi>1</span><span class=p>])</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>descriptor 'strip' for 'str' objects doesn't apply to a 'int' object</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>([</span><span class=s2>"x"</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>descriptor 'strip' for 'str' objects doesn't apply to a 'int' object</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>([])</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>ve</span><span class=p>)</span>
<span class=go>Invalid command [].</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>([</span><span class=s2>""</span><span class=p>])</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>ve</span><span class=p>)</span>
<span class=go>Invalid command [''].</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>""</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>ve</span><span class=p>)</span>
<span class=go>Invalid command [''].</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>working_dir</span><span class=o>=</span><span class=n>Path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span><span class=o>.</span><span class=n>up</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span><span class=o>.</span><span class=n>command</span>
<span class=go>('x',)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>working_dir</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>descriptor '__len__' requires a 'str' object but received a 'int'</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>working_dir</span><span class=o>=</span><span class=n>Path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>))</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>ve</span><span class=p>)[</span><span class=o>-</span><span class=mi>30</span><span class=p>:])</span>
<span class=go>does not identify a directory.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>23</span><span class=p>)</span><span class=o>.</span><span class=n>timeout</span>
<span class=go>23</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>1.2</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>timeout should be an instance of int but is float, namely 1.2.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>timeout should be an instance of int but is None.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>ve</span><span class=p>)</span>
<span class=go>timeout=0 is invalid, must be in 1..1000000.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>1_000_001</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>ve</span><span class=p>)</span>
<span class=go>timeout=1000001 is invalid, must be in 1..1000000.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=mi>1_000_001</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>te</span><span class=p>)[:</span><span class=mi>49</span><span class=p>])</span>
<span class=go>stdin should be an instance of any in {None, str}</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>sxx</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=p>{</span><span class=s2>"A"</span><span class=p>:</span> <span class=s2>"B"</span><span class=p>,</span> <span class=s2>"C"</span><span class=p>:</span> <span class=s2>"D"</span><span class=p>}))</span>
<span class=gp>>>> </span><span class=n>sxx</span><span class=p>[</span><span class=n>sxx</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s2>"with "</span><span class=p>):</span><span class=n>sxx</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s2>"with "</span><span class=p>)</span> <span class=o>+</span> <span class=mi>30</span><span class=p>]</span>
<span class=go>'with &LTenv> no stdin, stdout ig'</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=p>{</span><span class=s2>"A"</span><span class=p>:</span> <span class=s2>"B"</span><span class=p>,</span> <span class=s2>"C"</span><span class=p>:</span> <span class=mi>1</span><span class=p>})</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>te</span><span class=p>))</span>
<span class=go>descriptor 'strip' for 'str' objects doesn't apply to a 'int' object</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>te</span><span class=p>)[:</span><span class=o>-</span><span class=mi>20</span><span class=p>])</span>
<span class=go>env should be an instance of any in {typing.Iterable, typing.Mapping} b</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=nb>str</span><span class=p>(</span><span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=nb>dict</span><span class=p>()))[</span><span class=mi>0</span><span class=p>:</span><span class=mi>10</span><span class=p>]</span>
<span class=go>"('x',) in "</span>
</pre></div></div> <dl class="py attribute"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.command><span class="sig-name descname"><span class=pre>command</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#tuple><span class=pre>tuple</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><span class=pre>str</span></a><span class=p><span class=pre>,</span></span><span class=w> </span><span class=p><span class=pre>...</span></span><span class=p><span class=pre>]</span></span></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.command>¶</a><dd><p>the command line.</p></dl> <dl class="py attribute"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.env><span class="sig-name descname"><span class=pre>env</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#tuple><span class=pre>tuple</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#tuple><span class=pre>tuple</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><span class=pre>str</span></a><span class=p><span class=pre>,</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><span class=pre>str</span></a><span class=p><span class=pre>]</span></span><span class=p><span class=pre>,</span></span><span class=w> </span><span class=p><span class=pre>...</span></span><span class=p><span class=pre>]</span></span><span class=w> </span><span class=p><span class=pre>|</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><span class=pre>None</span></a></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.env>¶</a><dd><p>the environment variables to pass to the new process, if any</p></dl> <dl class="py method"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.execute><span class="sig-name descname"><span class=pre>execute</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>log_call</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>True</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/shell.html#Command.execute><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.execute>¶</a><dd><p>Execute the given process.</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><p><strong>log_call</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#bool><code class="xref py py-class docutils literal notranslate"><span class=pre>bool</span></code></a></span>, default: <code class="docutils literal notranslate"><span class=pre>True</span></code>) – should the call be logged? If <cite>True</cite>, the string representation of the <a class="reference internal"href=#pycommons.processes.shell.Command title=pycommons.processes.shell.Command><code class="xref py py-class docutils literal notranslate"><span class=pre>Command</span></code></a> will be written to the <cite>logger</cite>, otherwise nothing is logged. Note: The environment, if any, will not be printed for security reasons.</p><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#tuple><code class="xref py py-class docutils literal notranslate"><span class=pre>tuple</span></code></a>[<a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a>, <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a>]</span></p><dt class=field-odd>Returns<span class=colon>:</span><dd class=field-odd><p>a tuple with the standard output and standard error, which are only not <cite>None</cite> if they were supposed to be captured</p><dt class=field-even>Raises<span class=colon>:</span><dd class=field-even><ul class=simple><li><p><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/exceptions.html#TypeError><strong>TypeError</strong></a> – if any argument has the wrong type<li><p><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/exceptions.html#ValueError><strong>ValueError</strong></a> – if execution of the process failed</ul></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"123"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
<span class=go>('123\n', None)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>""</span><span class=p>,</span> <span class=s2>"123"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
<span class=go>('123\n', None)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>contextlib</span><span class=w> </span><span class=kn>import</span> <span class=n>redirect_stdout</span>
<span class=gp>>>> </span><span class=k>with</span> <span class=n>redirect_stdout</span><span class=p>(</span><span class=kc>None</span><span class=p>):</span>
<span class=gp>... </span>    <span class=n>s</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"123"</span><span class=p>),</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
<span class=gp>>>> </span><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
<span class=go>('123\n', None)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>Command</span><span class=p>(</span><span class=s2>"cat"</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=s2>"test"</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
<span class=go>('test', None)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>Command</span><span class=p>(</span><span class=s2>"cat"</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=s2>"test"</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
<span class=go>(None, None)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=k>with</span> <span class=n>redirect_stdout</span><span class=p>(</span><span class=kc>None</span><span class=p>):</span>
<span class=gp>... </span>        <span class=n>Command</span><span class=p>((</span><span class=s2>"ping"</span><span class=p>,</span> <span class=s2>"blabla!"</span><span class=p>))</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>ss</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>ve</span><span class=p>)</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>ss</span><span class=p>[:</span><span class=mi>20</span><span class=p>]</span> <span class=o>+</span> <span class=s2>" ... "</span> <span class=o>+</span> <span class=n>ss</span><span class=p>[</span><span class=o>-</span><span class=mi>22</span><span class=p>:])</span>
<span class=go>('ping', 'blabla!')  ...  yields return code 2.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=k>with</span> <span class=n>redirect_stdout</span><span class=p>(</span><span class=kc>None</span><span class=p>):</span>
<span class=gp>... </span>        <span class=n>Command</span><span class=p>((</span><span class=s2>"ping"</span><span class=p>,</span> <span class=s2>"www.example.com"</span><span class=p>,</span> <span class=s2>"-i 20"</span><span class=p>),</span>
<span class=gp>... </span>                <span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s2>"timed out after"</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>ve</span><span class=p>))</span>
<span class=go>True</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>log_call should be an instance of bool but is None.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>Command</span><span class=p>(</span><span class=s2>"x"</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>log_call should be an instance of bool but is int, namely 1.</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>with</span> <span class=n>redirect_stdout</span><span class=p>(</span><span class=kc>None</span><span class=p>):</span>
<span class=gp>... </span>    <span class=n>r</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"1"</span><span class=p>),</span> <span class=n>stderr</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
<span class=gp>... </span>            <span class=kc>True</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>r</span>
<span class=go>(None, '')</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>with</span> <span class=n>redirect_stdout</span><span class=p>(</span><span class=kc>None</span><span class=p>):</span>
<span class=gp>... </span>    <span class=n>r</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"printenv"</span><span class=p>,</span> <span class=p>),</span>
<span class=gp>... </span>                <span class=n>stdout</span><span class=o>=</span><span class=n>STREAM_CAPTURE</span><span class=p>,</span>
<span class=gp>... </span>                <span class=n>env</span><span class=o>=</span><span class=p>{</span><span class=s2>"BLA"</span><span class=p>:</span> <span class=s2>"XX"</span><span class=p>})</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>r</span>
<span class=go>('BLA=XX\n', None)</span>
</pre></div></div></dl> <dl class="py attribute"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.stderr><span class="sig-name descname"><span class=pre>stderr</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><span class=pre>int</span></a></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.stderr>¶</a><dd><p>how to handle the standard error stream</p></dl> <dl class="py attribute"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.stdin><span class="sig-name descname"><span class=pre>stdin</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><span class=pre>str</span></a><span class=w> </span><span class=p><span class=pre>|</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><span class=pre>None</span></a></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.stdin>¶</a><dd><p>the data to be written to stdin</p></dl> <dl class="py attribute"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.stdout><span class="sig-name descname"><span class=pre>stdout</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><span class=pre>int</span></a></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.stdout>¶</a><dd><p>how to handle the standard output stream</p></dl> <dl class="py attribute"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.timeout><span class="sig-name descname"><span class=pre>timeout</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><span class=pre>int</span></a></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.timeout>¶</a><dd><p>the timeout in seconds, after which the process will be terminated</p></dl> <dl class="py attribute"><dt class="sig sig-object py"id=pycommons.processes.shell.Command.working_dir><span class="sig-name descname"><span class=pre>working_dir</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference internal"href=pycommons.io.html#pycommons.io.path.Path title=pycommons.io.path.Path><span class=pre>Path</span></a></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.Command.working_dir>¶</a><dd><p>the working directory</p></dl></dl><dl class="py data"><dt class="sig sig-object py"id=pycommons.processes.shell.STREAM_CAPTURE><span class="sig-prename descclassname"><span class=pre>pycommons.processes.shell.</span></span><span class="sig-name descname"><span class=pre>STREAM_CAPTURE</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Final><span class=pre>Final</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><span class=pre>int</span></a><span class=p><span class=pre>]</span></span></span><span class=property><span class=w> </span><span class=p><span class=pre>=</span></span><span class=w> </span><span class=pre>2</span></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.STREAM_CAPTURE>¶</a><dd><p>capture the given stream</p></dl><dl class="py data"><dt class="sig sig-object py"id=pycommons.processes.shell.STREAM_FORWARD><span class="sig-prename descclassname"><span class=pre>pycommons.processes.shell.</span></span><span class="sig-name descname"><span class=pre>STREAM_FORWARD</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Final><span class=pre>Final</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><span class=pre>int</span></a><span class=p><span class=pre>]</span></span></span><span class=property><span class=w> </span><span class=p><span class=pre>=</span></span><span class=w> </span><span class=pre>1</span></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.STREAM_FORWARD>¶</a><dd><p>forward given stream to the same stream of this process</p></dl><dl class="py data"><dt class="sig sig-object py"id=pycommons.processes.shell.STREAM_IGNORE><span class="sig-prename descclassname"><span class=pre>pycommons.processes.shell.</span></span><span class="sig-name descname"><span class=pre>STREAM_IGNORE</span></span><span class=property><span class=p><span class=pre>:</span></span><span class=w> </span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Final><span class=pre>Final</span></a><span class=p><span class=pre>[</span></span><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><span class=pre>int</span></a><span class=p><span class=pre>]</span></span></span><span class=property><span class=w> </span><span class=p><span class=pre>=</span></span><span class=w> </span><span class=pre>0</span></span><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell.STREAM_IGNORE>¶</a><dd><p>ignore the given stream</p></dl></section><section id=module-pycommons.processes.shell_to_file><span id=pycommons-processes-shell-to-file-module></span><h2>pycommons.processes.shell_to_file module<a title="Link to this heading"class=headerlink href=#module-pycommons.processes.shell_to_file>¶</a></h2><p>A tool for invoking shell commands and piping their output to files.<p>To do this more or less safely and reliably, we create a script that invokes the original command. The script is created as temporary file and will be deleted after the command completes.<div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>pycommons.io.temp</span><span class=w> </span><span class=kn>import</span> <span class=n>temp_dir</span>
<span class=gp>>>> </span><span class=n>cmd</span> <span class=o>=</span> <span class=n>Command</span><span class=p>((</span><span class=s2>"echo"</span><span class=p>,</span> <span class=s2>"123"</span><span class=p>))</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>with</span> <span class=n>temp_dir</span><span class=p>()</span> <span class=k>as</span> <span class=n>td</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>so</span> <span class=o>=</span> <span class=n>td</span><span class=o>.</span><span class=n>resolve_inside</span><span class=p>(</span><span class=s2>"so.txt"</span><span class=p>)</span>
<span class=gp>... </span>    <span class=n>se</span> <span class=o>=</span> <span class=n>td</span><span class=o>.</span><span class=n>resolve_inside</span><span class=p>(</span><span class=s2>"se.txt"</span><span class=p>)</span>
<span class=gp>... </span>    <span class=n>to_files</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=n>so</span><span class=p>,</span> <span class=n>se</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"so: </span><span class=si>{</span><span class=n>so</span><span class=o>.</span><span class=n>read_all_str</span><span class=p>()</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
<span class=go>(None, None)</span>
<span class=go>so: 123</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>with</span> <span class=n>temp_dir</span><span class=p>()</span> <span class=k>as</span> <span class=n>td</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>so</span> <span class=o>=</span> <span class=n>td</span><span class=o>.</span><span class=n>resolve_inside</span><span class=p>(</span><span class=s2>"so.txt"</span><span class=p>)</span>
<span class=gp>... </span>    <span class=n>to_files</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=n>so</span><span class=p>,</span> <span class=n>so</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"so: </span><span class=si>{</span><span class=n>so</span><span class=o>.</span><span class=n>read_all_str</span><span class=p>()</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
<span class=go>(None, None)</span>
<span class=go>so: 123</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>to_files</span><span class=p>(</span><span class=s2>"a"</span><span class=p>,</span> <span class=s2>"a"</span><span class=p>,</span> <span class=s2>"b"</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>te</span><span class=p>)[:</span><span class=mi>10</span><span class=p>])</span>
<span class=go>command sh</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>to_files</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>"b"</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>stdout should be an instance of any in {None, str} but is int, namely 1.</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>to_files</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=s2>"a"</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>stderr should be an instance of any in {None, str} but is int, namely 1.</span>
</pre></div></div><div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>to_files</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>ve</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>ve</span><span class=p>)</span>
<span class=go>Either stdout or stderr must be specified.</span>
</pre></div></div><dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.shell_to_file.to_files><span class="sig-prename descclassname"><span class=pre>pycommons.processes.shell_to_file.</span></span><span class="sig-name descname"><span class=pre>to_files</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>command</span></span></em>, <em class=sig-param><span class=n><span class=pre>stdout</span></span></em>, <em class=sig-param><span class=n><span class=pre>stderr</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/shell_to_file.html#to_files><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.shell_to_file.to_files>¶</a><dd><p>Take an existing command and forward its stdout and/or stderr to files.</p> <p>Currently, providing text as standard input is not supported. You can provide either different or the same file for the standard output and standard error. If the same file is provided, then both streams will be merged into that file. Either way, the files you provide will be created and overwritten during the command execution. Notice that whatever original settings for standard error and standard output you provided in the original <a class="reference internal"href=#pycommons.processes.shell.Command title=pycommons.processes.shell.Command><code class="xref py py-class docutils literal notranslate"><span class=pre>Command</span></code></a> instance <cite>command</cite> will be ignored.</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><ul class=simple><li><p><strong>command</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference internal"href=#pycommons.processes.shell.Command title=pycommons.processes.shell.Command><code class="xref py py-class docutils literal notranslate"><span class=pre>Command</span></code></a></span>) – the command<li><p><strong>stdout</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a></span>) – the file to capture the stdout, or <cite>None</cite> if stdout should be ignored<li><p><strong>stderr</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a> | <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a></span>) – the file to capture the stderr, or <cite>None</cite> if stderr should be ignored</ul><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference internal"href=#pycommons.processes.shell.Command title=pycommons.processes.shell.Command><code class="xref py py-class docutils literal notranslate"><span class=pre>Command</span></code></a></span></p><dt class=field-odd>Returns<span class=colon>:</span><dd class=field-odd><p>the new command</p></dl></dl></section><section id=module-pycommons.processes.system_state><span id=pycommons-processes-system-state-module></span><h2>pycommons.processes.system_state module<a title="Link to this heading"class=headerlink href=#module-pycommons.processes.system_state>¶</a></h2><p>Functionality to log the current system state.<p>Here we provide a small program that can be executed concurrently with other activities and that logs information about the system state. This may be useful when running some computationally heavy experiments to find potential problems.<dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.system_state.collect_system_state><span class="sig-prename descclassname"><span class=pre>pycommons.processes.system_state.</span></span><span class="sig-name descname"><span class=pre>collect_system_state</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>collector</span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/system_state.html#collect_system_state><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.system_state.collect_system_state>¶</a><dd><p>Get a single string with the current state of the system.</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><p><strong>collector</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Callable><code class="xref py py-data docutils literal notranslate"><span class=pre>Callable</span></code></a>[[<a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a>, <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/stdtypes.html#str><code class="xref py py-class docutils literal notranslate"><span class=pre>str</span></code></a>], <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Any><code class="xref py py-data docutils literal notranslate"><span class=pre>Any</span></code></a>]</span>) – the collector to receive the key-value tuples</p><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a></span></p></dl> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>def</span><span class=w> </span><span class=nf>__ptr</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=gp>... </span>    <span class=k>pass</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=n>s</span> <span class=o>=</span> <span class=n>collect_system_state</span><span class=p>(</span><span class=n>__ptr</span><span class=p>)</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>collect_system_state</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>collector should be a callable but is None.</span>
</pre></div></div></dl><dl class="py function"><dt class="sig sig-object py"id=pycommons.processes.system_state.log_system_state><span class="sig-prename descclassname"><span class=pre>pycommons.processes.system_state.</span></span><span class="sig-name descname"><span class=pre>log_system_state</span></span><span class=sig-paren>(</span><em class=sig-param><span class=n><span class=pre>interval_seconds</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>300</span></span></em>, <em class=sig-param><span class=n><span class=pre>should_stop</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>&LTfunction</span> <span class=pre>&LTlambda>></span></span></em>, <em class=sig-param><span class=n><span class=pre>lock</span></span><span class=o><span class=pre>=</span></span><span class=default_value><span class=pre>&LTcontextlib.nullcontext</span> <span class=pre>object></span></span></em><span class=sig-paren>)</span><a class="reference internal"href=_modules/pycommons/processes/system_state.html#log_system_state><span class=viewcode-link><span class=pre>[source]</span></span></a><a title="Link to this definition"class=headerlink href=#pycommons.processes.system_state.log_system_state>¶</a><dd><p>Log the system state periodically to the stdout.</p> <p>This function allows for periodic logging of the system state to the standard output. This can be launched as a program running besides an experiment in order to help tracking potential problems. Let’s say that your experiment or whatever program crashes for unclear reasons. Why did it crash? We don’t know. Maybe it crashed because it ran out of memory. Maybe it ran out of disk space? Maybe not? Who knows. If you let this function here run concurrently to your program and pipe its output to a log file, then at least you will be able to see if the system slowly runs out of memory, disk space, or if the CPU gets too hot, or something. Or, at least, you can rule out that this is not the case.</p> <p>The output is presented in CSV format. Therefore, you can pipe it to a file and later open it in Excel or whatever. This allows you to draw diagrams of the usage of CPUs and memory or the temperature of the CPU over time.</p> <dl class="field-list simple"><dt class=field-odd>Parameters<span class=colon>:</span><dd class=field-odd><ul class=simple><li><p><strong>interval_seconds</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#int><code class="xref py py-class docutils literal notranslate"><span class=pre>int</span></code></a></span>, default: <code class="docutils literal notranslate"><span class=pre>300</span></code>) – the interval seconds<li><p><strong>should_stop</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/typing.html#typing.Callable><code class="xref py py-data docutils literal notranslate"><span class=pre>Callable</span></code></a>[[], <a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/functions.html#bool><code class="xref py py-class docutils literal notranslate"><span class=pre>bool</span></code></a>]</span>, default: <code class="docutils literal notranslate"><span class=pre>&LTfunction</span> <span class=pre>&LTlambda></span> <span class=pre>at</span> <span class=pre>0x7f75541a31a0></span></code>) – a function telling the logger when it should stop<li><p><strong>lock</strong> (<span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/contextlib.html#contextlib.AbstractContextManager><code class="xref py py-class docutils literal notranslate"><span class=pre>AbstractContextManager</span></code></a></span>, default: <code class="docutils literal notranslate"><span class=pre>&LTcontextlib.nullcontext</span> <span class=pre>object</span> <span class=pre>at</span> <span class=pre>0x7f754699d550></span></code>) – a shared lock for the console access</ul><dt class=field-even>Return type<span class=colon>:</span><dd class=field-even><p><span class=sphinx_autodoc_typehints-type><a class="reference external"title="(in Python v3.14)"href=https://docs.python.org/3/library/constants.html#None><code class="xref py py-obj docutils literal notranslate"><span class=pre>None</span></code></a></span></p></dl> <p># Example:</p> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>contextlib</span><span class=w> </span><span class=kn>import</span> <span class=n>redirect_stdout</span>
<span class=gp>>>> </span><span class=kn>from</span><span class=w> </span><span class=nn>io</span><span class=w> </span><span class=kn>import</span> <span class=n>StringIO</span>
<span class=gp>>>> </span><span class=n>sio</span> <span class=o>=</span> <span class=n>StringIO</span><span class=p>()</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>def</span><span class=w> </span><span class=nf>__three</span><span class=p>(</span><span class=n>lst</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>])</span> <span class=o>-></span> <span class=nb>bool</span><span class=p>:</span>
<span class=gp>... </span>    <span class=k>if</span> <span class=nb>list</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>lst</span><span class=p>)</span> <span class=o>></span> <span class=mi>0</span><span class=p>:</span>
<span class=gp>... </span>        <span class=k>del</span> <span class=n>lst</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<span class=gp>... </span>        <span class=k>return</span> <span class=kc>False</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>True</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>with</span> <span class=n>redirect_stdout</span><span class=p>(</span><span class=n>sio</span><span class=p>):</span>
<span class=gp>... </span>    <span class=n>log_system_state</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>__three</span><span class=p>)</span>
<span class=gp>>>> </span><span class=n>v</span> <span class=o>=</span> <span class=n>sio</span><span class=o>.</span><span class=n>getvalue</span><span class=p>()</span><span class=o>.</span><span class=n>splitlines</span><span class=p>()</span>
<span class=gp>>>> </span><span class=nb>len</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
<span class=go>4</span>
<span class=gp>>>> </span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>][:</span><span class=mi>20</span><span class=p>]</span>
<span class=go>'now;now.year;now.mon'</span>
<span class=gp>>>> </span><span class=n>i</span> <span class=o>=</span> <span class=nb>list</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>CSV_SEPARATOR</span><span class=p>))</span>
<span class=gp>>>> </span><span class=nb>all</span><span class=p>(</span><span class=nb>list</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=n>vv</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>CSV_SEPARATOR</span><span class=p>))</span> <span class=o>==</span> <span class=n>i</span> <span class=k>for</span> <span class=n>vv</span> <span class=ow>in</span> <span class=n>v</span><span class=p>)</span>
<span class=go>True</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>log_system_state</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>lock</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>te</span><span class=p>)[</span><span class=mi>0</span><span class=p>:</span><span class=mi>60</span><span class=p>])</span>
<span class=go>lock should be an instance of contextlib.AbstractContextMana</span>
</pre></div></div> <div class="doctest highlight-default notranslate"><div class=highlight><pre><span></span><span class=gp>>>> </span><span class=k>try</span><span class=p>:</span>
<span class=gp>... </span>    <span class=n>log_system_state</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>should_stop</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
<span class=gp>... </span><span class=k>except</span> <span class=ne>TypeError</span> <span class=k>as</span> <span class=n>te</span><span class=p>:</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>te</span><span class=p>)</span>
<span class=go>should_stop should be a callable but is None.</span>
</pre></div></div></dl></section></section><div class=clearer></div></div></div></div><div aria-label=Main class=sphinxsidebar role=navigation><div class=sphinxsidebarwrapper><div><h3><a href=index.html>Table of Contents</a></h3><ul><li><a class="reference internal"href=#>pycommons.processes package</a><ul><li><a class="reference internal"href=#submodules>Submodules</a><li><a class="reference internal"href=#module-pycommons.processes.caller>pycommons.processes.caller module</a><ul><li><a class="reference internal"href=#pycommons.processes.caller.is_build><code class="docutils literal notranslate"><span class=pre>is_build()</span></code></a><li><a class="reference internal"href=#pycommons.processes.caller.is_ci_run><code class="docutils literal notranslate"><span class=pre>is_ci_run()</span></code></a><li><a class="reference internal"href=#pycommons.processes.caller.is_doc_test><code class="docutils literal notranslate"><span class=pre>is_doc_test()</span></code></a></ul><li><a class="reference internal"href=#module-pycommons.processes.fork>pycommons.processes.fork module</a><ul><li><a class="reference internal"href=#pycommons.processes.fork.fork><code class="docutils literal notranslate"><span class=pre>fork()</span></code></a><li><a class="reference internal"href=#pycommons.processes.fork.get_cores><code class="docutils literal notranslate"><span class=pre>get_cores()</span></code></a></ul><li><a class="reference internal"href=#module-pycommons.processes.multishell>pycommons.processes.multishell module</a><ul><li><a class="reference internal"href=#pycommons.processes.multishell.multi_execute><code class="docutils literal notranslate"><span class=pre>multi_execute()</span></code></a></ul><li><a class="reference internal"href=#module-pycommons.processes.python>pycommons.processes.python module</a><ul><li><a class="reference internal"href=#pycommons.processes.python.PYTHON_ENV><code class="docutils literal notranslate"><span class=pre>PYTHON_ENV</span></code></a><li><a class="reference internal"href=#pycommons.processes.python.PYTHON_INTERPRETER><code class="docutils literal notranslate"><span class=pre>PYTHON_INTERPRETER</span></code></a><li><a class="reference internal"href=#pycommons.processes.python.PYTHON_INTERPRETER_SHORT><code class="docutils literal notranslate"><span class=pre>PYTHON_INTERPRETER_SHORT</span></code></a><li><a class="reference internal"href=#pycommons.processes.python.python_command><code class="docutils literal notranslate"><span class=pre>python_command()</span></code></a></ul><li><a class="reference internal"href=#module-pycommons.processes.shell>pycommons.processes.shell module</a><ul><li><a class="reference internal"href=#pycommons.processes.shell.Command><code class="docutils literal notranslate"><span class=pre>Command</span></code></a><ul><li><a class="reference internal"href=#pycommons.processes.shell.Command.command><code class="docutils literal notranslate"><span class=pre>Command.command</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.Command.env><code class="docutils literal notranslate"><span class=pre>Command.env</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.Command.execute><code class="docutils literal notranslate"><span class=pre>Command.execute()</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.Command.stderr><code class="docutils literal notranslate"><span class=pre>Command.stderr</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.Command.stdin><code class="docutils literal notranslate"><span class=pre>Command.stdin</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.Command.stdout><code class="docutils literal notranslate"><span class=pre>Command.stdout</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.Command.timeout><code class="docutils literal notranslate"><span class=pre>Command.timeout</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.Command.working_dir><code class="docutils literal notranslate"><span class=pre>Command.working_dir</span></code></a></ul><li><a class="reference internal"href=#pycommons.processes.shell.STREAM_CAPTURE><code class="docutils literal notranslate"><span class=pre>STREAM_CAPTURE</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.STREAM_FORWARD><code class="docutils literal notranslate"><span class=pre>STREAM_FORWARD</span></code></a><li><a class="reference internal"href=#pycommons.processes.shell.STREAM_IGNORE><code class="docutils literal notranslate"><span class=pre>STREAM_IGNORE</span></code></a></ul><li><a class="reference internal"href=#module-pycommons.processes.shell_to_file>pycommons.processes.shell_to_file module</a><ul><li><a class="reference internal"href=#pycommons.processes.shell_to_file.to_files><code class="docutils literal notranslate"><span class=pre>to_files()</span></code></a></ul><li><a class="reference internal"href=#module-pycommons.processes.system_state>pycommons.processes.system_state module</a><ul><li><a class="reference internal"href=#pycommons.processes.system_state.collect_system_state><code class="docutils literal notranslate"><span class=pre>collect_system_state()</span></code></a><li><a class="reference internal"href=#pycommons.processes.system_state.log_system_state><code class="docutils literal notranslate"><span class=pre>log_system_state()</span></code></a></ul></ul></ul></div><div><h4>Previous topic</h4><p class=topless><a title="previous chapter"href=pycommons.net.html>pycommons.net package</a></div><div><h4>Next topic</h4><p class=topless><a title="next chapter"href=pycommons.strings.html>pycommons.strings package</a></div><div aria-label="source link"role=note><h3>This Page</h3><ul class=this-page-menu><li><a href=_sources/pycommons.processes.rst.txt rel=nofollow>Show Source</a></ul></div><search id=searchbox role=search style=display:none> <h3 id=searchlabel>Quick search</h3> <div class=searchformwrapper><form action=search.html class=search><input aria-labelledby=searchlabel autocapitalize=off autocomplete=off autocorrect=off name=q spellcheck=false><input type=submit value=Go></form></div> </search><script>document.getElementById(`searchbox`).style.display=`block`;</script></div></div><div class=clearer></div></div><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"href=genindex.html>index</a><li class=right><a title="Python Module Index"href=py-modindex.html>modules</a> |<li class=right><a title="pycommons.strings package"href=pycommons.strings.html>next</a> |<li class=right><a title="pycommons.net package"href=pycommons.net.html>previous</a> |<li class="nav-item nav-item-0"><a href=index.html>pycommons 0.8.89 documentation</a> »<li class="nav-item nav-item-1"><a href=modules.html>pycommons</a> »<li class="nav-item nav-item-2"><a href=pycommons.html>pycommons package</a> »<li class="nav-item nav-item-this"><a href>pycommons.processes package</a></ul></div><div class=footer role=contentinfo>© Copyright 2023-2026, Thomas Weise.</div>
